Screens:
  EmployeeDashboardScreen:
    Properties:
      Fill: =Colors.BackgroundLight
      OnVisible: |
        =// Load SharePoint data first - prioritize over demo data
        Set(varLoadingRequests, true);
        
        // Try to load from SharePoint NameCardRequest table
        IfError(
          ClearCollect(colNameCardRequests, 
            Filter(NameCardRequest, 
              EmployeeId = varCurrentEmployee.Id
            )
          ),
          // Fallback to demo data if SharePoint unavailable
          ClearCollect(colNameCardRequests,
            {Id: 1, EmployeeId: 1, EmployeeName: "Nguy·ªÖn VƒÉn An", RequestDate: Date(2024, 1, 15), 
             CardType: "Standard", Department: "Ph√≤ng C√¥ng ngh·ªá th√¥ng tin", JobTitle: "Tr∆∞·ªüng ph√≤ng", 
             Status: "Approved", ApprovalDate: Date(2024, 1, 18), 
             RequestedBy: "Nguy·ªÖn VƒÉn An", PrintStatus: "Printed", DistributionDate: Date(2024, 1, 20),
             Notes: "Th·∫ª t√™n cho tr∆∞·ªüng ph√≤ng m·ªõi", Priority: "Normal"},
            {Id: 2, EmployeeId: 1, EmployeeName: "Nguy·ªÖn VƒÉn An", RequestDate: Date(2024, 1, 10), 
             CardType: "Executive", Department: "Ph√≤ng C√¥ng ngh·ªá th√¥ng tin", JobTitle: "Tr∆∞·ªüng ph√≤ng", 
             Status: "PendingManagerApproval", ApprovalDate: Blank(), 
             RequestedBy: "Nguy·ªÖn VƒÉn An", PrintStatus: "NotPrinted", DistributionDate: Blank(),
             Notes: "Th·∫ª t√™n executive cho s·ª± ki·ªán quan tr·ªçng", Priority: "High"},
            {Id: 3, EmployeeId: 1, EmployeeName: "Nguy·ªÖn VƒÉn An", RequestDate: Date(2024, 1, 5), 
             CardType: "Temporary", Department: "Ph√≤ng C√¥ng ngh·ªá th√¥ng tin", JobTitle: "Chuy√™n vi√™n", 
             Status: "Rejected", ApprovalDate: Date(2024, 1, 8), 
             RequestedBy: "Nguy·ªÖn VƒÉn An", PrintStatus: "NotPrinted", DistributionDate: Blank(),
             Notes: "Th·∫ª t·∫°m th·ªùi cho d·ª± √°n", Priority: "Low"}
          );
          Notify("ƒêang s·ª≠ d·ª•ng d·ªØ li·ªáu demo - kh√¥ng th·ªÉ k·∫øt n·ªëi SharePoint", NotificationType.Warning)
        );
        
        Set(varCurrentEmployee, {Id: 1, FullName: "Nguy·ªÖn VƒÉn An", Department: "Ph√≤ng C√¥ng ngh·ªá th√¥ng tin", Role: "Employee"});
        Set(varShowRequestForm, false);
        Set(varFormMode, "Create");
        Set(varEditingRequest, Blank());
        Set(varSelectedRequest, Blank());
        Set(varShowRequestDetails, false);
        Set(varFilterStatus, "All");
        Set(varSearchText, "");
        Set(varShowContextMenu, false);
        Set(varContextMenuX, 0);
        Set(varContextMenuY, 0);
        Set(varLoadingRequests, false);
        
        UpdateContext({
          statsData: {
            TotalRequests: CountRows(Filter(colNameCardRequests, EmployeeId = varCurrentEmployee.Id)),
            PendingRequests: CountRows(Filter(colNameCardRequests, EmployeeId = varCurrentEmployee.Id && Status = "PendingManagerApproval")),
            ApprovedRequests: CountRows(Filter(colNameCardRequests, EmployeeId = varCurrentEmployee.Id && Status = "Approved")),
            RejectedRequests: CountRows(Filter(colNameCardRequests, EmployeeId = varCurrentEmployee.Id && Status = "Rejected"))
          }
        })
    Children:
      - Main.Content.Container_1:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            Fill: =Colors.BackgroundLight
            Height: =Parent.Height - Styles.Header.Height
            Width: =Parent.Width - Styles.Navigation.Width
            X: =Styles.Navigation.Width
            Y: =Styles.Header.Height
          Children:
            - Page.Header.Section_1:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                Children:
                  - Page.Title_1:
                      Control: Label
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height * 0.35
                        Size: =FontSizes.XLarge
                        Text: ="Dashboard nh√¢n vi√™n"
                        Width: =Parent.Width * 0.5
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.15
                  - Page.Subtitle_1:
                      Control: Label
                      Properties:
                        Color: =Colors.TextMuted
                        Height: =Parent.Height * 0.35
                        Size: =FontSizes.Base
                        Text: =Concatenate("Xin ch√†o, ", varCurrentEmployee.FullName)
                        Width: =Parent.Width * 0.5
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.5
                  - Create.Request.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =If(varLoadingRequests, Colors.PrimaryLight, Colors.Primary)
                        BorderThickness: =If(varLoadingRequests, 2, 1)
                        Color: =Styles.Button.Primary.Color
                        DisplayMode: =If(varLoadingRequests, DisplayMode.Disabled, DisplayMode.Edit)
                        Fill: =If(varLoadingRequests, ColorFade(Styles.Button.Primary.Fill, 30%), Styles.Button.Primary.Fill)
                        Height: =Styles.Button.Height
                        HoverFill: =If(varLoadingRequests, Styles.Button.Primary.Fill, ColorFade(Styles.Button.Primary.HoverFill, -5%))
                        OnSelect: |
                          =Set(varLoadingRequests, true);
                          Set(varFormMode, "Create");
                          Set(varEditingRequest, Blank());
                          Set(varLoadingRequests, false);
                          Set(varShowRequestForm, true)
                        PressedFill: =ColorFade(Styles.Button.Primary.Fill, -10%)
                        Size: =FontSizes.Medium
                        Text: =If(varLoadingRequests, LoadingStates.Button.Text, "+ T·∫°o y√™u c·∫ßu th·∫ª t√™n")
                        Width: =Parent.Width * 0.25
                        X: =Parent.Width - Parent.Width * 0.28
                        Y: =Parent.Height * 0.2
            - Stats.Cards.Section:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.18
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.12
                Children:
                  - Total.Requests.Card_1:
                      Control: CanvasComponent
                      ComponentName: StatsCardComponent
                      Properties:
                        BorderColor: =Colors.Primary
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =Parent.Height * 0.8
                        IsClickable: =true
                        IsLoading: =false
                        Title: ="T·ªïng y√™u c·∫ßu"
                        Value: =Text(statsData.TotalRequests)
                        ValueColor: =Colors.Primary
                        Width: =Parent.Width * 0.22
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.1
                  - Pending.Requests.Card:
                      Control: CanvasComponent
                      ComponentName: StatsCardComponent
                      Properties:
                        BorderColor: =Colors.Warning
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =Parent.Height * 0.8
                        IsClickable: =true
                        IsLoading: =false
                        Title: ="Ch·ªù duy·ªát"
                        Value: =Text(statsData.PendingRequests)
                        ValueColor: =Colors.Warning
                        Width: =Parent.Width * 0.22
                        X: =Parent.Width * 0.27
                        Y: =Parent.Height * 0.1
                  - Approved.Requests.Card_1:
                      Control: CanvasComponent
                      ComponentName: StatsCardComponent
                      Properties:
                        BorderColor: =Colors.Success
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =Parent.Height * 0.8
                        IsClickable: =true
                        IsLoading: =false
                        Title: ="ƒê√£ duy·ªát"
                        Value: =Text(statsData.ApprovedRequests)
                        ValueColor: =Colors.Success
                        Width: =Parent.Width * 0.22
                        X: =Parent.Width * 0.51
                        Y: =Parent.Height * 0.1
                  - Rejected.Requests.Card_1:
                      Control: CanvasComponent
                      ComponentName: StatsCardComponent
                      Properties:
                        BorderColor: =Colors.Error
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =Parent.Height * 0.8
                        IsClickable: =true
                        IsLoading: =false
                        Title: ="B·ªã t·ª´ ch·ªëi"
                        Value: =Text(statsData.RejectedRequests)
                        ValueColor: =Colors.Error
                        Width: =Parent.Width * 0.22
                        X: =Parent.Width * 0.75
                        Y: =Parent.Height * 0.1
            - Requests.List.Section:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.7
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.3
                Children:
                  - Filter.Search.Bar:
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        Fill: =Colors.White
                        Height: =Parent.Height * 0.1
                        Width: =Parent.Width * 0.94
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.02
                      Children:
                        - Section.Title:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Bold
                              Height: =Parent.Height * 0.4
                              Size: =FontSizes.Large
                              Text: ="Danh s√°ch y√™u c·∫ßu th·∫ª t√™n"
                              Width: =Parent.Width * 0.3
                              X: =Parent.Width * 0.02
                              Y: =Parent.Height * 0.1
                        - Status.Filter_1:
                            Control: Classic/DropDown
                            Properties:
                              BorderColor: =Colors.Border
                              Default: ="T·∫•t c·∫£"
                              Fill: =Colors.White
                              Height: =Styles.Input.Height
                              Items: |
                                =Table(
                                {Value: "All", Text: "T·∫•t c·∫£"},
                                {Value: "PendingManagerApproval", Text: "Ch·ªù duy·ªát"},
                                {Value: "Approved", Text: "ƒê√£ duy·ªát"},
                                {Value: "Rejected", Text: "B·ªã t·ª´ ch·ªëi"}
                                )
                              DisplayFields: =["Text"]
                              OnChange: |
                                =Set(varFilterStatus, Self.Selected.Result.Value)
                              Width: =Parent.Width * 0.2
                              X: =Parent.Width * 0.45
                              Y: =Parent.Height * 0.25
                        - Search.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =Colors.Border
                              Color: =Colors.TextPrimary
                              Default: =""
                              Fill: =Colors.White
                              FocusedBorderColor: =Colors.Primary
                              Height: =Styles.Input.Height
                              HintText: ="T√¨m ki·∫øm theo ghi ch√∫..."
                              OnChange: |
                                =Set(varSearchText, Self.Text)
                              Size: =FontSizes.Base
                              Width: =Parent.Width * 0.3
                              X: =Parent.Width * 0.68
                              Y: =Parent.Height * 0.25
                  - Requests.Data.Container:
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        Fill: =Colors.White
                        Height: =Parent.Height * 0.84
                        Width: =Parent.Width * 0.94
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.14
                      Children:
                        - Requests.DataTable:
                            Control: DataTable
                            Properties:
                              BorderColor: =RGBA(0, 0, 0, 0)
                              Color: =RGBA(50, 49, 48, 1)
                              Fill: =RGBA(255, 255, 255, 1)
                              Font: =Font.'Segoe UI'
                              HeadingColor: =RGBA(255, 255, 255, 1)
                              HeadingFill: =RGBA(0, 120, 212, 1)
                              HeadingFont: =Font.'Segoe UI'
                              Height: =Parent.Height
                              Items: |
                                =Filter(colNameCardRequests, 
                                  And(
                                    EmployeeId = varCurrentEmployee.Id,
                                    Or(varFilterStatus = "All", Status = varFilterStatus),
                                    Or(IsBlank(varSearchText), varSearchText = "", Notes Like "*" & varSearchText & "*")
                                  )
                                )
                              Size: =13
                              Width: =Parent.Width
                            Children:
                              - RequestID.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="M√£ YC"
                                    FieldName: ="RequestID"
                                    Order: =1
                                    Text: =Concatenate("YC-", Text(ThisItem.Id, "000"))
                                    Width: =90
                              - RequestDate.Column:
                                  Control: DataTableColumn
                                  Variant: DateTime
                                  Properties:
                                    FieldDisplayName: ="Ng√†y t·∫°o"
                                    FieldName: ="RequestDate"
                                    Order: =2
                                    Text: =Text(ThisItem.RequestDate, "dd/mm/yyyy")
                                    Width: =100
                              - CardType.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Lo·∫°i th·∫ª"
                                    FieldName: ="CardType"
                                    Order: =3
                                    Text: =ThisItem.CardType
                                    Width: =120
                              - Priority.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="∆Øu ti√™n"
                                    FieldName: ="Priority"
                                    Order: =4
                                    Text: |
                                      =Switch(ThisItem.Priority,
                                        "High", "Cao",
                                        "Normal", "Th∆∞·ªùng", 
                                        "Low", "Th·∫•p",
                                        "Th∆∞·ªùng"
                                      )
                                    Width: =80
                              - JobTitle.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Ch·ª©c v·ª•"
                                    FieldName: ="JobTitle"
                                    Order: =5
                                    Text: =ThisItem.JobTitle
                                    Width: =150
                              - Department.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Ph√≤ng ban"
                                    FieldName: ="Department"
                                    Order: =6
                                    Text: =ThisItem.Department
                                    Width: =180
                              - Status.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Tr·∫°ng th√°i"
                                    FieldName: ="Status"
                                    Order: =7
                                    Text: |
                                      =Switch(ThisItem.Status,
                                        "PendingManagerApproval", "Ch·ªù duy·ªát",
                                        "PendingHRApproval", "Ch·ªù HR",
                                        "Approved", "ƒê√£ duy·ªát",
                                        "Rejected", "T·ª´ ch·ªëi",
                                        "Printing", "ƒêang in",
                                        "Printed", "ƒê√£ in",
                                        "Distributed", "ƒê√£ ph√°t",
                                        "Kh√¥ng x√°c ƒë·ªãnh"
                                      )
                                    Width: =120
                              - Notes.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Ghi ch√∫"
                                    FieldName: ="Notes"
                                    Order: =8
                                    Text: =Left(ThisItem.Notes, 50) & If(Len(ThisItem.Notes) > 50, "...", "")
                                    Width: =200
                        - DataTable.Selection.Handler:
                            Control: Rectangle
                            Properties:
                              Fill: =RGBA(0, 0, 0, 0)
                              Height: ='Requests.DataTable'.Height
                              OnSelect: |
                                =If(Not(IsBlank('Requests.DataTable'.Selected)),
                                    Set(varSelectedRequest, 'Requests.DataTable'.Selected);
                                    Set(varContextMenuX, 200);
                                    Set(varContextMenuY, 300);
                                    Set(varShowContextMenu, true)
                                )
                              Width: ='Requests.DataTable'.Width
                              X: ='Requests.DataTable'.X
                              Y: ='Requests.DataTable'.Y
                        - Request.Context.Menu:
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =1
                              Fill: =Colors.White
                              Height: =120
                              Visible: =varShowContextMenu
                              Width: =150
                              X: =varContextMenuX
                              Y: =varContextMenuY
                            Children:
                              - View.Context.Button:
                                  Control: Classic/Button
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =Colors.TextPrimary
                                    Fill: =RGBA(0, 0, 0, 0)
                                    HoverFill: =Colors.BackgroundLight
                                    OnSelect: |
                                      =Set(varShowRequestDetails, true);
                                      Set(varShowContextMenu, false)
                                    Size: =FontSizes.Base
                                    Text: ="üëÅ Xem chi ti·∫øt"
                                    Width: =Parent.Width
                              - Edit.Context.Button:
                                  Control: Classic/Button
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =Colors.TextPrimary
                                    DisplayMode: |
                                      =If(varSelectedRequest.Status = "PendingManagerApproval", DisplayMode.Edit, DisplayMode.Disabled)
                                    Fill: =RGBA(0, 0, 0, 0)
                                    HoverFill: =Colors.BackgroundLight
                                    OnSelect: |
                                      =Set(varFormMode, "Edit");
                                      Set(varEditingRequest, varSelectedRequest);
                                      Set(varShowRequestForm, true);
                                      Set(varShowContextMenu, false)
                                    Size: =FontSizes.Base
                                    Text: ="‚úé Ch·ªânh s·ª≠a"
                                    Width: =Parent.Width
                                    Y: =40
      - Context.Menu.Overlay:
          Control: Rectangle
          Properties:
            Fill: =RGBA(0, 0, 0, 0)
            Height: =Parent.Height
            OnSelect: |
              =Set(varShowContextMenu, false)
            Visible: =varShowContextMenu
            Width: =Parent.Width
      - Request.Form.Modal.Overlay:
          Control: Rectangle
          Properties:
            Fill: =Styles.Modal.Overlay
            Height: =Parent.Height
            OnSelect: |
              =Set(varShowRequestForm, false)
            Visible: =varShowRequestForm
            Width: =Parent.Width
      - Request.Form.Modal:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            Fill: =Colors.White
            Height: =Parent.Height * 0.8
            Visible: =varShowRequestForm
            Width: =Parent.Width * 0.6
            X: =If(varShowRequestForm, (Parent.Width - Parent.Width * 0.6) / 2, -Parent.Width)
            Y: =If(varShowRequestForm, (Parent.Height - Parent.Height * 0.8) / 2, -Parent.Height)
          Children:
            - Modal.Header:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.Primary
                  Height: =Parent.Height * 0.1
                  Width: =Parent.Width
                Children:
                  - Modal.Title:
                      Control: Label
                      Properties:
                        Color: =Colors.White
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        Size: =FontSizes.Large
                        Text: =If(varFormMode = "Create", "T·∫°o y√™u c·∫ßu th·∫ª t√™n m·ªõi", "Ch·ªânh s·ª≠a y√™u c·∫ßu th·∫ª t√™n")
                        Width: =Parent.Width * 0.8
                        X: =Parent.Width * 0.04
                  - Modal.Close.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.White
                        Color: =Colors.White
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =Parent.Height * 0.6
                        OnSelect: |
                          =Set(varShowRequestForm, false)
                        Size: =FontSizes.Large
                        Text: ="√ó"
                        Width: =Parent.Height * 0.6
                        X: =Parent.Width * 0.9
                        Y: =Parent.Height * 0.2
            - Form.Content:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.8
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.1
                Children:
                  - CardType.Label:
                      Control: Label
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =Parent.Height * 0.08
                        Size: =FontSizes.Medium
                        Text: ="Lo·∫°i th·∫ª t√™n *"
                        Width: =Parent.Width * 0.4
                        X: =Parent.Width * 0.05
                        Y: =Parent.Height * 0.05
                  - CardType.Dropdown:
                      Control: DropDown
                      Properties:
                        BorderColor: =Colors.Border
                        DefaultSelectedItems: |
                          =If(varFormMode = "Edit", Filter(Table({Name: "Standard"}, {Name: "Executive"}, {Name: "Temporary"}), Name = varEditingRequest.CardType), Table({Name: "Standard"}))
                        Fill: =Colors.White
                        Height: =Styles.Input.Height
                        Items: |
                          =Table(
                          {Name: "Standard", Description: "Th·∫ª t√™n ti√™u chu·∫©n"},
                          {Name: "Executive", Description: "Th·∫ª t√™n c·∫•p qu·∫£n l√Ω"},
                          {Name: "Temporary", Description: "Th·∫ª t√™n t·∫°m th·ªùi"}
                          )
                        Width: =Parent.Width * 0.4
                        X: =Parent.Width * 0.05
                        Y: =Parent.Height * 0.13
                  - Priority.Label:
                      Control: Label
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =Parent.Height * 0.08
                        Size: =FontSizes.Medium
                        Text: ="M·ª©c ƒë·ªô ∆∞u ti√™n *"
                        Width: =Parent.Width * 0.4
                        X: =Parent.Width * 0.55
                        Y: =Parent.Height * 0.05
                  - Priority.Dropdown:
                      Control: DropDown
                      Properties:
                        BorderColor: =Colors.Border
                        DefaultSelectedItems: |
                          =If(varFormMode = "Edit", Filter(Table({Name: "Low"}, {Name: "Normal"}, {Name: "High"}), Name = varEditingRequest.Priority), Table({Name: "Normal"}))
                        Fill: =Colors.White
                        Height: =Styles.Input.Height
                        Items: |
                          =Table(
                          {Name: "Low", Description: "M·ª©c ƒë·ªô th·∫•p"},
                          {Name: "Normal", Description: "M·ª©c ƒë·ªô th∆∞·ªùng"},
                          {Name: "High", Description: "M·ª©c ƒë·ªô cao"}
                          )
                        Width: =Parent.Width * 0.4
                        X: =Parent.Width * 0.55
                        Y: =Parent.Height * 0.13
                  - JobTitle.Label:
                      Control: Label
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =Parent.Height * 0.08
                        Size: =FontSizes.Medium
                        Text: ="Ch·ª©c v·ª• hi·ªÉn th·ªã *"
                        Width: =Parent.Width * 0.4
                        X: =Parent.Width * 0.05
                        Y: =Parent.Height * 0.25
                  - JobTitle.Input:
                      Control: Classic/TextInput
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Colors.TextPrimary
                        Default: =If(varFormMode = "Edit", varEditingRequest.JobTitle, varCurrentEmployee.FullName)
                        Fill: =Colors.White
                        FocusedBorderColor: =Colors.Primary
                        Height: =Styles.Input.Height
                        HintText: ="Nh·∫≠p ch·ª©c v·ª• hi·ªÉn th·ªã tr√™n th·∫ª"
                        Size: =FontSizes.Base
                        Width: =Parent.Width * 0.4
                        X: =Parent.Width * 0.05
                        Y: =Parent.Height * 0.33
                  - Department.Form.Label:
                      Control: Label
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =Parent.Height * 0.08
                        Size: =FontSizes.Medium
                        Text: ="Ph√≤ng ban hi·ªÉn th·ªã *"
                        Width: =Parent.Width * 0.4
                        X: =Parent.Width * 0.55
                        Y: =Parent.Height * 0.25
                  - Department.Input:
                      Control: Classic/TextInput
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Colors.TextPrimary
                        Default: =If(varFormMode = "Edit", varEditingRequest.Department, varCurrentEmployee.Department)
                        Fill: =Colors.White
                        FocusedBorderColor: =Colors.Primary
                        Height: =Styles.Input.Height
                        HintText: ="Nh·∫≠p ph√≤ng ban hi·ªÉn th·ªã tr√™n th·∫ª"
                        Size: =FontSizes.Base
                        Width: =Parent.Width * 0.4
                        X: =Parent.Width * 0.55
                        Y: =Parent.Height * 0.33
                  - Notes.Label:
                      Control: Label
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =Parent.Height * 0.08
                        Size: =FontSizes.Medium
                        Text: ="Ghi ch√∫"
                        Width: =Parent.Width * 0.9
                        X: =Parent.Width * 0.05
                        Y: =Parent.Height * 0.45
                  - Notes.Input:
                      Control: Classic/TextInput
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Colors.TextPrimary
                        Default: =If(varFormMode = "Edit", varEditingRequest.Notes, "")
                        Fill: =Colors.White
                        FocusedBorderColor: =Colors.Primary
                        Height: =Parent.Height * 0.15
                        HintText: ="Nh·∫≠p ghi ch√∫ ho·∫∑c y√™u c·∫ßu ƒë·∫∑c bi·ªát..."
                        Mode: =TextMode.MultiLine
                        Size: =FontSizes.Base
                        Width: =Parent.Width * 0.9
                        X: =Parent.Width * 0.05
                        Y: =Parent.Height * 0.53
            - Form.Footer:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.1
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.9
                Children:
                  - Cancel.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Styles.Button.Secondary.Color
                        Fill: =Styles.Button.Secondary.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Secondary.HoverFill
                        OnSelect: |
                          =Set(varShowRequestForm, false)
                        Size: =FontSizes.Medium
                        Text: ="H·ªßy"
                        Width: =Parent.Width * 0.15
                        X: =Parent.Width * 0.6
                        Y: =Parent.Height * 0.2
                  - Save.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Primary
                        Color: =Styles.Button.Primary.Color
                        DisplayMode: |
                          =If(And(Not(IsBlank('CardType.Dropdown'.Selected.Result.Name)), Not(IsBlank('JobTitle.Input'.Text)), Not(IsBlank('Department.Input'.Text))), DisplayMode.Edit, DisplayMode.Disabled)
                        Fill: =Styles.Button.Primary.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Primary.HoverFill
                        OnSelect: |
                          =Set(varLoadingRequests, true);
                          
                          If(varFormMode = "Create",
                            // CREATE - Try SharePoint first, fallback to collection
                            IfError(
                              Patch(NameCardRequest, Defaults(NameCardRequest), {
                                EmployeeId: varCurrentEmployee.Id,
                                EmployeeName: varCurrentEmployee.FullName,
                                RequestDate: Today(),
                                CardType: 'CardType.Dropdown'.Selected.Result.Name,
                                Department: 'Department.Input'.Text,
                                JobTitle: 'JobTitle.Input'.Text,
                                Status: "PendingManagerApproval",
                                ApprovalDate: Blank(),
                                RequestedBy: varCurrentEmployee.FullName,
                                PrintStatus: "NotPrinted",
                                DistributionDate: Blank(),
                                Notes: 'Notes.Input'.Text,
                                Priority: 'Priority.Dropdown'.Selected.Result.Name
                              });
                              // Refresh collection from SharePoint
                              ClearCollect(colNameCardRequests, 
                                Filter(NameCardRequest, EmployeeId = varCurrentEmployee.Id)
                              ),
                              // Fallback to collection if SharePoint fails
                              Collect(colNameCardRequests, {
                                Id: Max(colNameCardRequests, Id) + 1,
                                EmployeeId: varCurrentEmployee.Id,
                                EmployeeName: varCurrentEmployee.FullName,
                                RequestDate: Today(),
                                CardType: 'CardType.Dropdown'.Selected.Result.Name,
                                Department: 'Department.Input'.Text,
                                JobTitle: 'JobTitle.Input'.Text,
                                Status: "PendingManagerApproval",
                                ApprovalDate: Blank(),
                                RequestedBy: varCurrentEmployee.FullName,
                                PrintStatus: "NotPrinted",
                                DistributionDate: Blank(),
                                Notes: 'Notes.Input'.Text,
                                Priority: 'Priority.Dropdown'.Selected.Result.Name
                              });
                              Notify("L∆∞u offline - s·∫Ω ƒë·ªìng b·ªô khi c√≥ k·∫øt n·ªëi", NotificationType.Warning)
                            ),
                            // EDIT - Try SharePoint first, fallback to collection
                            IfError(
                              Patch(NameCardRequest, 
                                LookUp(NameCardRequest, Id = varEditingRequest.Id), {
                                  CardType: 'CardType.Dropdown'.Selected.Result.Name,
                                  Department: 'Department.Input'.Text,
                                  JobTitle: 'JobTitle.Input'.Text,
                                  Notes: 'Notes.Input'.Text,
                                  Priority: 'Priority.Dropdown'.Selected.Result.Name
                                }
                              );
                              // Refresh collection from SharePoint
                              ClearCollect(colNameCardRequests, 
                                Filter(NameCardRequest, EmployeeId = varCurrentEmployee.Id)
                              ),
                              // Fallback to collection update
                              UpdateIf(colNameCardRequests, Id = varEditingRequest.Id, {
                                CardType: 'CardType.Dropdown'.Selected.Result.Name,
                                Department: 'Department.Input'.Text,
                                JobTitle: 'JobTitle.Input'.Text,
                                Notes: 'Notes.Input'.Text,
                                Priority: 'Priority.Dropdown'.Selected.Result.Name
                              });
                              Notify("C·∫≠p nh·∫≠t offline - s·∫Ω ƒë·ªìng b·ªô khi c√≥ k·∫øt n·ªëi", NotificationType.Warning)
                            )
                          );
                          
                          Set(varShowRequestForm, false);
                          Set(varLoadingRequests, false);
                          
                          UpdateContext({
                            statsData: {
                              TotalRequests: CountRows(Filter(colNameCardRequests, EmployeeId = varCurrentEmployee.Id)),
                              PendingRequests: CountRows(Filter(colNameCardRequests, EmployeeId = varCurrentEmployee.Id && Status = "PendingManagerApproval")),
                              ApprovedRequests: CountRows(Filter(colNameCardRequests, EmployeeId = varCurrentEmployee.Id && Status = "Approved")),
                              RejectedRequests: CountRows(Filter(colNameCardRequests, EmployeeId = varCurrentEmployee.Id && Status = "Rejected"))
                            }
                          });
                          
                          Notify(If(varFormMode = "Create", "ƒê√£ t·∫°o y√™u c·∫ßu th·∫ª t√™n th√†nh c√¥ng!", "ƒê√£ c·∫≠p nh·∫≠t y√™u c·∫ßu th·∫ª t√™n!"), NotificationType.Success)
                        Size: =FontSizes.Medium
                        Text: =If(varFormMode = "Create", "T·∫°o y√™u c·∫ßu", "C·∫≠p nh·∫≠t")
                        Width: =Parent.Width * 0.18
                        X: =Parent.Width * 0.78
                        Y: =Parent.Height * 0.2
      - Request.Details.Modal.Overlay:
          Control: Rectangle
          Properties:
            Fill: =Styles.Modal.Overlay
            Height: =Parent.Height
            OnSelect: |
              =Set(varShowRequestDetails, false)
            Visible: =varShowRequestDetails
            Width: =Parent.Width
      - Request.Details.Modal:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            Fill: =Colors.White
            Height: =Parent.Height * 0.7
            Visible: =varShowRequestDetails
            Width: =Parent.Width * 0.5
            X: =If(varShowRequestDetails, (Parent.Width - Parent.Width * 0.5) / 2, -Parent.Width)
            Y: =If(varShowRequestDetails, (Parent.Height - Parent.Height * 0.7) / 2, -Parent.Height)
          Children:
            - Details.Modal.Header_1:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.Primary
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                Children:
                  - Details.Modal.Title_1:
                      Control: Label
                      Properties:
                        Color: =Colors.White
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        Size: =FontSizes.Large
                        Text: ="Chi ti·∫øt y√™u c·∫ßu th·∫ª t√™n"
                        Width: =Parent.Width * 0.8
                        X: =Parent.Width * 0.04
                  - Details.Modal.Close.Button_1:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.White
                        Color: =Colors.White
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =Parent.Height * 0.6
                        OnSelect: |
                          =Set(varShowRequestDetails, false)
                        Size: =FontSizes.Large
                        Text: ="√ó"
                        Width: =Parent.Height * 0.6
                        X: =Parent.Width * 0.9
                        Y: =Parent.Height * 0.2
            - Details.Content:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.88
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.12
                Children:
                  - Details.Info.Container:
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =Colors.BorderLight
                        BorderThickness: =1
                        Fill: =Colors.BackgroundLight
                        Height: =Parent.Height * 0.9
                        Width: =Parent.Width * 0.9
                        X: =Parent.Width * 0.05
                        Y: =Parent.Height * 0.05
                      Children:
                        - Request.ID.Detail:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Bold
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: |
                                =Concatenate("M√£ y√™u c·∫ßu:YC-", Text(varSelectedRequest.Id, "000"))
                              Width: =Parent.Width * 0.45
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.05
                        - Request.Date.Detail_1:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: =Concatenate("Ng√†y t·∫°o:", Text(varSelectedRequest.RequestDate, "dd/mm/yyyy"))
                              Width: =Parent.Width * 0.45
                              X: =Parent.Width * 0.5
                              Y: =Parent.Height * 0.05
                        - Card.Type.Detail_1:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: =Concatenate("Lo·∫°i th·∫ª:", varSelectedRequest.CardType)
                              Width: =Parent.Width * 0.45
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.15
                        - Priority.Detail_1:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: =Concatenate("ƒê·ªô ∆∞u ti√™n:", Switch(varSelectedRequest.Priority, "High", "Cao", "Normal", "Th∆∞·ªùng", "Low", "Th·∫•p", "Th∆∞·ªùng"))
                              Width: =Parent.Width * 0.45
                              X: =Parent.Width * 0.5
                              Y: =Parent.Height * 0.15
                        - Job.Title.Detail:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: =Concatenate("Ch·ª©c v·ª•:", varSelectedRequest.JobTitle)
                              Width: =Parent.Width * 0.45
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.25
                        - Department.Detail_1:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: =Concatenate("Ph√≤ng ban:", varSelectedRequest.Department)
                              Width: =Parent.Width * 0.45
                              X: =Parent.Width * 0.5
                              Y: =Parent.Height * 0.25
                        - Status.Detail:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: =Concatenate("Tr·∫°ng th√°i:", Switch(varSelectedRequest.Status, "PendingManagerApproval", "Ch·ªù duy·ªát", "Approved", "ƒê√£ duy·ªát", "Rejected", "T·ª´ ch·ªëi", varSelectedRequest.Status))
                              Width: =Parent.Width * 0.45
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.35
                        - Approval.Date.Detail:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: |
                                =If(IsBlank(varSelectedRequest.ApprovalDate), "Ng√†y duy·ªát:Ch∆∞a duy·ªát", Concatenate("Ng√†y duy·ªát:", Text(varSelectedRequest.ApprovalDate, "dd/mm/yyyy")))
                              Width: =Parent.Width * 0.45
                              X: =Parent.Width * 0.5
                              Y: =Parent.Height * 0.35
                        - Print.Status.Detail:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: =Concatenate("Tr·∫°ng th√°i in:", If(varSelectedRequest.PrintStatus = "Printed", "ƒê√£ in", "Ch∆∞a in"))
                              Width: =Parent.Width * 0.45
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.45
                        - Distribution.Date.Detail:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: =If(IsBlank(varSelectedRequest.DistributionDate), "Ng√†y ph√°t:Ch∆∞a ph√°t", Concatenate("Ng√†y ph√°t:", Text(varSelectedRequest.DistributionDate, "dd/mm/yyyy")))
                              Width: =Parent.Width * 0.45
                              X: =Parent.Width * 0.5
                              Y: =Parent.Height * 0.45
                        - Notes.Label.Detail:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Base
                              Text: ="Ghi ch√∫:"
                              Width: =Parent.Width * 0.9
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.55
                        - Notes.Content.Detail:
                            Control: Label
                            Properties:
                              Color: =Colors.TextMuted
                              Height: =Parent.Height * 0.3
                              Size: =FontSizes.Base
                              Text: =If(IsBlank(varSelectedRequest.Notes), "Kh√¥ng c√≥ ghi ch√∫", varSelectedRequest.Notes)
                              VerticalAlign: =VerticalAlign.Top
                              Width: =Parent.Width * 0.9
                              X: =Parent.Width * 0.05
                              Y: =Parent.Height * 0.63
