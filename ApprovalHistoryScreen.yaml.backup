Screens:
  ApprovalHistoryScreen_1:
    Properties:
      Fill: =Colors.BackgroundLight
      OnVisible: |
        =// Sử dụng SharePoint data thay vì demo data
        IfError(
          // Load SharePoint data (thay thế demo data)
          ClearCollect(colApprovalHistoryRaw, NamecardRequest);
          ClearCollect(colApprovalHistory,
            AddColumns(
              AddColumns(
                colApprovalHistoryRaw,
                EmployeeName, LookUp(User_1, userID = ThisRecord.userID).fullname
              ),
              Department, LookUp(Department_1, departmentID = LookUp(User_1, userID = ThisRecord.userID).departmentID.Value).name
            )
          ),
          // Fallback to demo data if SharePoint fails
          ClearCollect(colApprovalHistory,
            {Id: 1, RequestId: 1, RequestCode: "YC-001", EmployeeName: "Nguyễn Văn An", CardType: "Standard", 
             RequestDate: Date(2024, 1, 15), Status: "Approved", ApprovalSteps: [
               {Step: 1, ApproverRole: "Manager", ApproverName: "Trần Thị Bình", ApprovalDate: Date(2024, 1, 16), Status: "Approved", Comments: "Đồng ý cấp thẻ tên cho nhân viên"},
               {Step: 2, ApproverRole: "HR", ApproverName: "Lê Văn Cường", ApprovalDate: Date(2024, 1, 18), Status: "Approved", Comments: "Thông tin hợp lệ, chuyển in thẻ"}
             ],
             Department: "Phòng Công nghệ thông tin", Priority: "Normal", CurrentStep: 2, TotalSteps: 2},
            {Id: 2, RequestId: 2, RequestCode: "YC-002", EmployeeName: "Nguyễn Văn An", CardType: "Executive", 
             RequestDate: Date(2024, 1, 10), Status: "PendingManagerApproval", ApprovalSteps: [
               {Step: 1, ApproverRole: "Manager", ApproverName: "", ApprovalDate: Blank(), Status: "Pending", Comments: ""}
             ],
             Department: "Phòng Công nghệ thông tin", Priority: "High", CurrentStep: 1, TotalSteps: 2},
            {Id: 3, RequestId: 3, RequestCode: "YC-003", EmployeeName: "Nguyễn Văn An", CardType: "Temporary", 
             RequestDate: Date(2024, 1, 5), Status: "Rejected", ApprovalSteps: [
               {Step: 1, ApproverRole: "Manager", ApproverName: "Trần Thị Bình", ApprovalDate: Date(2024, 1, 8), Status: "Rejected", Comments: "Không cần thiết cho dự án ngắn hạn"}
             ],
             Department: "Phòng Công nghệ thông tin", Priority: "Low", CurrentStep: 1, TotalSteps: 2},
            {Id: 4, RequestId: 4, RequestCode: "YC-004", EmployeeName: "Phạm Thị Dung", CardType: "Standard", 
             RequestDate: Date(2024, 1, 20), Status: "PendingHRApproval", ApprovalSteps: [
               {Step: 1, ApproverRole: "Manager", ApproverName: "Trần Thị Bình", ApprovalDate: Date(2024, 1, 22), Status: "Approved", Comments: "Nhân viên mới, cần thẻ tên"},
               {Step: 2, ApproverRole: "HR", ApproverName: "", ApprovalDate: Blank(), Status: "Pending", Comments: ""}
             ],
             Department: "Phòng Marketing", Priority: "Normal", CurrentStep: 2, TotalSteps: 2}
          )
        );
        Set(varCurrentUser, {FullName: "Trần Thị Bình", Role: "Manager", Department: "Phòng Công nghệ thông tin"});
        Set(varSelectedApproval, Blank());
        Set(varShowApprovalDetails, false);
        Set(varFilterStatus, "All");
        Set(varFilterPriority, "All");
        Set(varDateFrom, Blank());
        Set(varDateTo, Blank());
        Set(varSearchEmployee, "");
        UpdateContext({
          summaryStats: {
            TotalRequests: CountRows(colApprovalHistory),
            PendingApprovals: CountRows(Filter(colApprovalHistory, Status in ["PendingManagerApproval", "PendingHRApproval"])),
            ApprovedRequests: CountRows(Filter(colApprovalHistory, Status = "Approved")),
            RejectedRequests: CountRows(Filter(colApprovalHistory, Status = "Rejected"))
          }
        })
    Children:
      - Main.Content.Container_4:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Fill: =Colors.BackgroundLight
            Height: =Parent.Height - Styles.Header.Height
            Width: =Parent.Width - Styles.Navigation.Width
            X: =Styles.Navigation.Width
            Y: =Styles.Header.Height
          Children:
            - Page.Header.Section_4:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                Children:
                  - Page.Title_4:
                      Control: Label@2.5.1
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height * 0.35
                        Size: =FontSizes.XLarge
                        Text: ="Lịch sử phê duyệt"
                        Width: =Parent.Width * 0.5
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.15
                  - Page.Subtitle_3:
                      Control: Label@2.5.1
                      Properties:
                        Color: =Colors.TextMuted
                        Height: =Parent.Height * 0.35
                        Size: =FontSizes.Base
                        Text: ="Theo dõi và quản lý quá trình phê duyệt yêu cầu thẻ tên"
                        Width: =Parent.Width * 0.5
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.5
            - Summary.Stats.Section_1:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.18
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.12
                Children:
                  - Total.Requests.Card_3:
                      Control: CanvasComponent
                      ComponentName: StatsCardComponent
                      Properties:
                        BorderColor: =Colors.Primary
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =Parent.Height * 0.8
                        IsClickable: =true
                        IsLoading: =false
                        Title: ="Tổng yêu cầu"
                        Value: =Text(summaryStats.TotalRequests)
                        ValueColor: =Colors.Primary
                        Width: =Parent.Width * 0.22
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.1
                  - Pending.Approvals.Card_1:
                      Control: CanvasComponent
                      ComponentName: StatsCardComponent
                      Properties:
                        BorderColor: =Colors.Warning
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =Parent.Height * 0.8
                        IsClickable: =true
                        IsLoading: =false
                        Title: ="Chờ phê duyệt"
                        Value: =Text(summaryStats.PendingApprovals)
                        ValueColor: =Colors.Warning
                        Width: =Parent.Width * 0.22
                        X: =Parent.Width * 0.27
                        Y: =Parent.Height * 0.1
                  - Approved.Requests.Card_3:
                      Control: CanvasComponent
                      ComponentName: StatsCardComponent
                      Properties:
                        BorderColor: =Colors.Success
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =Parent.Height * 0.8
                        IsClickable: =true
                        IsLoading: =false
                        Title: ="Đã phê duyệt"
                        Value: =Text(summaryStats.ApprovedRequests)
                        ValueColor: =Colors.Success
                        Width: =Parent.Width * 0.22
                        X: =Parent.Width * 0.51
                        Y: =Parent.Height * 0.1
                  - Rejected.Requests.Card_3:
                      Control: CanvasComponent
                      ComponentName: StatsCardComponent
                      Properties:
                        BorderColor: =Colors.Error
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =Parent.Height * 0.8
                        IsClickable: =true
                        IsLoading: =false
                        Title: ="Bị từ chối"
                        Value: =Text(summaryStats.RejectedRequests)
                        ValueColor: =Colors.Error
                        Width: =Parent.Width * 0.22
                        X: =Parent.Width * 0.75
                        Y: =Parent.Height * 0.1
            - Filters.Section_1:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.3
                Children:
                  - Filters.Title_2:
                      Control: Label@2.5.1
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height * 0.3
                        Size: =FontSizes.Medium
                        Text: ="Bộ lọc"
                        Width: =Parent.Width * 0.2
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.1
                  - Status.Filter_3:
                      Control: DropDown@0.0.45
                      Properties:
                        BorderColor: =Colors.Border
                        DefaultSelectedItems: |
                          =Table({Name: "Tất cả", Value: "All"})
                        Fill: =Colors.White
                        Height: =Styles.Input.Height
                        Items: |
                          =Table(
                          {Name: "Tất cả", Value: "All"},
                          {Name: "Chờ phê duyệt", Value: "Pending"},
                          {Name: "Đã phê duyệt", Value: "Approved"},
                          {Name: "Bị từ chối", Value: "Rejected"}
                          )
                        OnChange: |
                          =Set(varFilterStatus, Self.Selected.Value)
                        Width: =Parent.Width * 0.15
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.5
                  - Priority.Filter_2:
                      Control: DropDown@0.0.45
                      Properties:
                        BorderColor: =Colors.Border
                        DefaultSelectedItems: |
                          =Table({Name: "Tất cả", Value: "All"})
                        Fill: =Colors.White
                        Height: =Styles.Input.Height
                        Items: |
                          =Table(
                          {Name: "Tất cả", Value: "All"},
                          {Name: "Cao", Value: "High"},
                          {Name: "Thường", Value: "Normal"},
                          {Name: "Thấp", Value: "Low"}
                          )
                        OnChange: |
                          =Set(varFilterPriority, Self.Selected.Value)
                        Width: =Parent.Width * 0.12
                        X: =Parent.Width * 0.2
                        Y: =Parent.Height * 0.5
                  - Employee.Search_1:
                      Control: Classic/TextInput@2.3.2
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Colors.TextPrimary
                        Default: =""
                        Fill: =Colors.White
                        FocusedBorderColor: =Colors.Primary
                        Height: =Styles.Input.Height
                        HintText: ="Tìm kiếm nhân viên..."
                        OnChange: |
                          =Set(varSearchEmployee, Self.Text)
                        Size: =FontSizes.Small
                        Width: =Parent.Width * 0.2
                        X: =Parent.Width * 0.34
                        Y: =Parent.Height * 0.5
                  - Date.From.Label_2:
                      Control: Label@2.5.1
                      Properties:
                        Color: =Colors.TextPrimary
                        Height: =Parent.Height * 0.25
                        Size: =FontSizes.Small
                        Text: ="Từ ngày:"
                        Width: =Parent.Width * 0.08
                        X: =Parent.Width * 0.56
                        Y: =Parent.Height * 0.2
                  - Date.From.Input_2:
                      Control: Classic/DatePicker@2.6.0
                      Properties:
                        BorderColor: =Colors.Border
                        DefaultDate: =Blank()
                        Fill: =Colors.White
                        Height: =Styles.Input.Height
                        OnChange: |
                          =Set(varDateFrom, Self.SelectedDate)
                        Size: =FontSizes.Small
                        Width: =Parent.Width * 0.12
                        X: =Parent.Width * 0.56
                        Y: =Parent.Height * 0.5
                  - Date.To.Label_2:
                      Control: Label@2.5.1
                      Properties:
                        Color: =Colors.TextPrimary
                        Height: =Parent.Height * 0.25
                        Size: =FontSizes.Small
                        Text: ="Đến ngày:"
                        Width: =Parent.Width * 0.08
                        X: =Parent.Width * 0.7
                        Y: =Parent.Height * 0.2
                  - Date.To.Input_2:
                      Control: Classic/DatePicker@2.6.0
                      Properties:
                        BorderColor: =Colors.Border
                        DefaultDate: =Blank()
                        Fill: =Colors.White
                        Height: =Styles.Input.Height
                        OnChange: |
                          =Set(varDateTo, Self.SelectedDate)
                        Size: =FontSizes.Small
                        Width: =Parent.Width * 0.12
                        X: =Parent.Width * 0.7
                        Y: =Parent.Height * 0.5
                  - Clear.Filters.Button_3:
                      Control: Classic/Button@2.2.0
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Styles.Button.Secondary.Color
                        Fill: =Styles.Button.Secondary.Fill
                        Height: =Styles.Input.Height
                        HoverFill: =Styles.Button.Secondary.HoverFill
                        OnSelect: |
                          =Reset('Status.Filter_3');
                          Reset('Priority.Filter_2');
                          Reset('Employee.Search_1');
                          Reset('Date.From.Input_2');
                          Reset('Date.To.Input_2');
                          Set(varFilterStatus, "All");
                          Set(varFilterPriority, "All");
                          Set(varSearchEmployee, "");
                          Set(varDateFrom, Blank());
                          Set(varDateTo, Blank())
                        Size: =FontSizes.Small
                        Text: ="Xóa bộ lọc"
                        Width: =Parent.Width * 0.12
                        X: =Parent.Width * 0.85
                        Y: =Parent.Height * 0.5
            - Approval.History.List.Section_1:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.58
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.42
                Children:
                  - History.Section.Title_1:
                      Control: Label@2.5.1
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height * 0.08
                        Size: =FontSizes.Large
                        Text: ="Danh sách lịch sử phê duyệt"
                        Width: =Parent.Width * 0.5
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.02
                  - DataTable.Selection.Handler_1:
                      Control: Rectangle@2.3.0
                      Properties:
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =416.44
                        OnSelect: |
                          =If(Not(IsBlank('Approval.History.DataTable'.Selected)),
                            Set(varSelectedApproval, 'Approval.History.DataTable'.Selected);
                            Set(varShowApprovalDetails, true)
                          )
                        Width: =1166
      - Approval.History.DataTable:
          Control: DataTable@1.0.3
          Properties:
            BorderColor: =RGBA(0, 0, 0, 0)
            Color: =Colors.TextPrimary
            Fill: =Colors.White
            Font: =Font.'Segoe UI'
            HeadingColor: =Colors.White
            HeadingFill: =Colors.Primary
            HeadingFont: =Font.'Segoe UI'
            Height: =368
            Items: |
              =Filter(colApprovalHistory,
                // Filter by status
                If(varFilterStatus = "All", true, 
                  If(varFilterStatus = "Pending", Status in ["PendingManagerApproval", "PendingHRApproval"],
                    If(varFilterStatus = "Approved", Status = "Approved",
                      If(varFilterStatus = "Rejected", Status = "Rejected", true)
                    )
                  )
                ) &&
                // Filter by priority  
                If(varFilterPriority = "All", true, Priority = varFilterPriority) &&
                // Filter by employee name
                If(IsBlank(varSearchEmployee), true, 
                  EmployeeName in varSearchEmployee || 
                  StartsWith(Lower(EmployeeName), Lower(varSearchEmployee))
                ) &&
                // Filter by date range
                If(IsBlank(varDateFrom), true, RequestDate >= varDateFrom) &&
                If(IsBlank(varDateTo), true, RequestDate <= varDateTo)
              )
            Width: =1166
            X: =200
            Y: =400
          Children:
            - RequestCode.Column:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Mã yêu cầu"
                  FieldName: ="RequestCode"
                  Order: =1
                  Text: =ThisItem.RequestCode
                  Width: =120
            - Employee.Column:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Nhân viên"
                  FieldName: ="EmployeeName"
                  Order: =2
                  Text: =ThisItem.EmployeeName
                  Width: =180
            - CardType.Column:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Loại thẻ"
                  FieldName: ="CardType"
                  Order: =3
                  Text: |
                    =Switch(ThisItem.CardType,
                      "Standard", "Tiêu chuẩn",
                      "Executive", "Điều hành", 
                      "Temporary", "Tạm thời",
                      ThisItem.CardType
                    )
                  Width: =120
            - RequestDate.Column:
                Control: DataTableColumn@1.0.1
                Variant: DateTime
                Properties:
                  FieldDisplayName: ="Ngày tạo"
                  FieldName: ="RequestDate"
                  Order: =4
                  Text: =Text(ThisItem.RequestDate, "dd/mm/yyyy")
            - Priority.Column:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Ưu tiên"
                  FieldName: ="Priority"
                  Order: =5
                  Text: |
                    =Switch(ThisItem.Priority,
                      "High", "Cao",
                      "Normal", "Thường", 
                      "Low", "Thấp",
                      ThisItem.Priority
                    )
                  Width: =80
            - Status.Column_1:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Trạng thái"
                  FieldName: ="Status"
                  Order: =6
                  Text: |
                    =Switch(ThisItem.Status,
                      "PendingManagerApproval", "Chờ Manager phê duyệt",
                      "PendingHRApproval", "Chờ HR phê duyệt",
                      "Approved", "Đã phê duyệt",
                      "Rejected", "Bị từ chối",
                      "Không xác định"
                    )
                  Width: =150
            - Actions.Column:
                Control: DataTableColumn@1.0.1
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Thao tác"
                  FieldName: ="Actions"
                  Order: =7
                  Text: "=\"\U0001F441 Xem chi tiết\""
                  Width: =120
      - Approval.Details.Modal.Overlay_1:
          Control: Rectangle@2.3.0
          Properties:
            Fill: =Styles.Modal.Overlay
            Height: =Parent.Height
            OnSelect: |
              =Set(varShowApprovalDetails, false)
            Visible: =varShowApprovalDetails
            Width: =Parent.Width
      - Approval.Details.Modal_1:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Fill: =Colors.White
            Height: =Parent.Height * 0.8
            Visible: =varShowApprovalDetails
            Width: =Parent.Width * 0.7
            X: =If(varShowApprovalDetails, (Parent.Width - Parent.Width * 0.7) / 2, -Parent.Width)
            Y: =If(varShowApprovalDetails, (Parent.Height - Parent.Height * 0.8) / 2, -Parent.Height)
          Children:
            - Details.Modal.Header_2:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.Primary
                  Height: =Parent.Height * 0.1
                  Width: =Parent.Width
                Children:
                  - Details.Modal.Title_2:
                      Control: Label@2.5.1
                      Properties:
                        Color: =Colors.White
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        Size: =FontSizes.Large
                        Text: ="Chi tiết lịch sử phê duyệt"
                        Width: =Parent.Width * 0.8
                        X: =Parent.Width * 0.04
                  - Details.Modal.Close.Button_2:
                      Control: Classic/Button@2.2.0
                      Properties:
                        BorderColor: =Colors.White
                        Color: =Colors.White
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =Parent.Height * 0.6
                        OnSelect: |
                          =Set(varShowApprovalDetails, false)
                        Size: =FontSizes.Large
                        Text: ="×"
                        Width: =Parent.Height * 0.6
                        X: =Parent.Width * 0.9
                        Y: =Parent.Height * 0.2
            - Details.Modal.Content_1:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.9
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.1
                Children:
                  - Request.Info.Section_1:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =Colors.BorderLight
                        BorderThickness: =1
                        Fill: =Colors.BackgroundLight
                        Height: =Parent.Height * 0.25
                        Width: =Parent.Width * 0.94
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.02
                      Children:
                        - Info.Section.Title_1:
                            Control: Label@2.5.1
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Bold
                              Height: =Parent.Height * 0.2
                              Size: =FontSizes.Medium
                              Text: ="Thông tin yêu cầu"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.05
                        - Request.Code.Detail_1:
                            Control: Label@2.5.1
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.25
                              Size: =FontSizes.Small
                              Text: |
                                =Concatenate("Mã yêu cầu:", varSelectedApproval.RequestCode)
                              Width: =Parent.Width * 0.23
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.3
                        - Employee.Name.Detail_1:
                            Control: Label@2.5.1
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.25
                              Size: =FontSizes.Small
                              Text: =Concatenate("Nhân viên:", varSelectedApproval.EmployeeName)
                              Width: =Parent.Width * 0.24
                              X: =Parent.Width * 0.26
                              Y: =Parent.Height * 0.3
                        - Card.Type.Detail_2:
                            Control: Label@2.5.1
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.25
                              Size: =FontSizes.Small
                              Text: =Concatenate("Loại thẻ:", varSelectedApproval.CardType)
                              Width: =Parent.Width * 0.23
                              X: =Parent.Width * 0.5
                              Y: =Parent.Height * 0.3
                        - Priority.Detail_2:
                            Control: Label@2.5.1
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.25
                              Size: =FontSizes.Small
                              Text: =Concatenate("Ưu tiên:", Switch(varSelectedApproval.Priority, "High", "Cao", "Normal", "Thường", "Low", "Thấp", "Thường"))
                              Width: =Parent.Width * 0.24
                              X: =Parent.Width * 0.73
                              Y: =Parent.Height * 0.3
                        - Request.Date.Detail_2:
                            Control: Label@2.5.1
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.25
                              Size: =FontSizes.Small
                              Text: =Concatenate("Ngày tạo:", Text(varSelectedApproval.RequestDate, "dd/mm/yyyy"))
                              Width: =Parent.Width * 0.23
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.6
                        - Department.Detail_2:
                            Control: Label@2.5.1
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.25
                              Size: =FontSizes.Small
                              Text: =Concatenate("Phòng ban:", varSelectedApproval.Department)
                              Width: =Parent.Width * 0.24
                              X: =Parent.Width * 0.26
                              Y: =Parent.Height * 0.6
                        - Current.Status.Detail_1:
                            Control: Label@2.5.1
                            Properties:
                              Color: =Colors.TextPrimary
                              Height: =Parent.Height * 0.25
                              Size: =FontSizes.Small
                              Text: =Concatenate("Trạng thái hiện tại:", Switch(varSelectedApproval.Status, "PendingManagerApproval", "Chờ Manager phê duyệt", "PendingHRApproval", "Chờ HR phê duyệt", "Approved", "Đã phê duyệt", "Rejected", "Bị từ chối", "Không xác định"))
                              Width: =Parent.Width * 0.47
                              X: =Parent.Width * 0.5
                              Y: =Parent.Height * 0.6
                  - Approval.Timeline.Section_1:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        Fill: =Colors.BackgroundLight
                        Height: =Parent.Height * 0.69
                        Width: =Parent.Width * 0.94
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.29
                      Children:
                        - Timeline.Section.Title_1:
                            Control: Label@2.5.1
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Bold
                              Height: =Parent.Height * 0.08
                              Size: =FontSizes.Medium
                              Text: ="Timeline phê duyệt"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.02
                        - Approval.Steps.Gallery_1:
                            Control: Gallery@2.15.0
                            Variant: Vertical
                            Properties:
                              Height: =Parent.Height * 0.86
                              Items: =varSelectedApproval.ApprovalSteps
                              TemplatePadding: =4
                              TemplateSize: =Parent.Height * 0.25
                              Width: =Parent.Width * 0.94
                              X: =Parent.Width * 0.03
                              Y: =Parent.Height * 0.12
                            Children:
                              - Step.Container_1:
                                  Control: Rectangle@2.3.0
                                  Properties:
                                    BorderColor: =Colors.BorderLight
                                    BorderThickness: =1
                                    Fill: =Colors.White
                                    Height: =Parent.TemplateHeight
                                    Width: =Parent.Width
                              - Step.Number.Circle_1:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    Fill: |
                                      =Switch(ThisItem.Status,
                                        "Approved", Colors.Success,
                                        "Rejected", Colors.Error,
                                        "Pending", Colors.Warning,
                                        Colors.Border
                                      )
                                    Height: =Parent.Height * 0.6
                                    Width: =Parent.Height * 0.6
                                    X: =Parent.Width * 0.03
                                    Y: =Parent.Height * 0.2
                                  Children:
                                    - Step.Number.Text_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          Color: =Colors.White
                                          FontWeight: =FontWeight.Bold
                                          Height: =Parent.Height
                                          Size: =FontSizes.Medium
                                          Text: =Text(ThisItem.Step)
                                          Width: =Parent.Width
                              - Step.Role.Label_1:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =Colors.TextPrimary
                                    FontWeight: =FontWeight.Bold
                                    Height: =Parent.Height * 0.3
                                    Size: =FontSizes.Small
                                    Text: =Concatenate("Bước ", Text(ThisItem.Step), ":", ThisItem.ApproverRole)
                                    Width: =Parent.Width * 0.2
                                    X: =Parent.Width * 0.12
                                    Y: =Parent.Height * 0.1
                              - Step.Approver.Name_1:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =If(IsBlank(ThisItem.ApproverName), Colors.TextMuted, Colors.TextPrimary)
                                    Height: =Parent.Height * 0.3
                                    Size: =FontSizes.Small
                                    Text: =If(IsBlank(ThisItem.ApproverName), "Chưa có người phê duyệt", ThisItem.ApproverName)
                                    Width: =Parent.Width * 0.2
                                    X: =Parent.Width * 0.32
                                    Y: =Parent.Height * 0.1
                              - Step.Approval.Date_1:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =If(IsBlank(ThisItem.ApprovalDate), Colors.TextMuted, Colors.TextPrimary)
                                    Height: =Parent.Height * 0.3
                                    Size: =FontSizes.Small
                                    Text: =If(IsBlank(ThisItem.ApprovalDate), "Chưa phê duyệt", Text(ThisItem.ApprovalDate, "dd/mm/yyyy"))
                                    Width: =Parent.Width * 0.15
                                    X: =Parent.Width * 0.52
                                    Y: =Parent.Height * 0.1
                              - Step.Status.Badge_1:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    Fill: |
                                      =Switch(ThisItem.Status,
                                        "Approved", StatusColors.ApprovedBg,
                                        "Rejected", StatusColors.RejectedBg,
                                        "Pending", StatusColors.PendingBg,
                                        Colors.BorderLight
                                      )
                                    Height: =Parent.Height * 0.4
                                    Width: =Parent.Width * 0.12
                                    X: =Parent.Width * 0.67
                                    Y: =Parent.Height * 0.05
                                  Children:
                                    - Step.Status.Text_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          Color: |
                                            =Switch(ThisItem.Status,
                                              "Approved", StatusColors.ApprovedText,
                                              "Rejected", StatusColors.RejectedText,
                                              "Pending", StatusColors.PendingText,
                                              Colors.TextMuted
                                            )
                                          FontWeight: =FontWeight.Semibold
                                          Height: =Parent.Height
                                          Size: =FontSizes.Small
                                          Text: |
                                            =Switch(ThisItem.Status,
                                              "Approved", "Đã duyệt",
                                              "Rejected", "Từ chối",
                                              "Pending", "Chờ duyệt",
                                              "Không rõ"
                                            )
                                          Width: =Parent.Width
                              - Step.Comments.Label_1:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =Colors.TextPrimary
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height * 0.2
                                    Size: =FontSizes.Small
                                    Text: ="Nhận xét:"
                                    Width: =Parent.Width * 0.15
                                    X: =Parent.Width * 0.12
                                    Y: =Parent.Height * 0.45
                              - Step.Comments.Text_1:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =If(IsBlank(ThisItem.Comments), Colors.TextMuted, Colors.TextPrimary)
                                    Height: =Parent.Height * 0.3
                                    Size: =FontSizes.Small
                                    Text: =If(IsBlank(ThisItem.Comments), "Không có nhận xét", ThisItem.Comments)
                                    VerticalAlign: =VerticalAlign.Top
                                    Width: =Parent.Width * 0.85
                                    X: =Parent.Width * 0.12
                                    Y: =Parent.Height * 0.65
