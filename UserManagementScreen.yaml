Screens:
  UserManagementScreen:
    Properties:
      Fill: =Colors.BackgroundLight
      OnVisible: "=// Set current user email for security checks\n  Set(varCurrentUserEmail, User().Email);\n  \n  // Load SharePoint data first\n  ClearCollect(colDepartments, Department_1);\n  ClearCollect(\n    colDepartmentsWithAll,\n    Table({Value: \"Tất cả\"}),\n    AddColumns(Department_1, Value, name)\n    );\n  ClearCollect(colRoles, Role_1);\n  ClearCollect(\n    colRolesWithAll,\n    Table({Value: \"Tất cả\"}),\n    AddColumns(Role_1, Value, name)\n    );\n  ClearCollect(colUserRoles, UserRole);\n\n  ClearCollect(colUsersRaw, User_1);\n\n  ClearCollect(\n      colUsersWithDept,\n      AddColumns(\n          colUsersRaw,\n          Department,\n          LookUp(colDepartments, departmentID = ThisRecord.departmentID).name\n      )\n  );\n\n  ClearCollect(\n      colUsers,\n      AddColumns(\n          colUsersWithDept,\n          Role,\n          LookUp(\n              colRoles,\n              roleID = LookUp(colUserRoles, userID.Value = ThisRecord.userID.Value).roleID.Value\n          ).name\n      )\n  );\n    // Reset form states\n    Set(varShowUserForm, false);\n    Set(varFormMode, \"Add\");\n    Set(varEditingUser, Blank());\n    Set(varSelectedUser, Blank());\n    Set(varDeleteConfirm, false);\n    Set(varLoadingUsers, false);\n    Set(varErrorMessage, \"\");\n    Set(varShowUserDetail, false);\n    Set(varDetailFormMode, \"View\");\n    Set(varShowContextMenu, false);\n    Set(varContextMenuX, 0);\n    Set(varContextMenuY, 0);\n    // Initialize filter variables\n    Set(varSearchText, \"\");\n    Set(varSelectedDepartment, \"\");\n    Set(varSelectedRole, \"\");\n    \n    \n    // Create filtered collection\n    Set(varFilteredUsers, colUsers);\n"
    Children:
      - Main.Content.Container_3:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            Fill: =Colors.BackgroundLight
            Height: =Parent.Height - Styles.Header.Height
            Width: =Parent.Width - Styles.Navigation.Width
            X: =Styles.Navigation.Width
            Y: =Styles.Header.Height
          Children:
            - Page.Header.Section_3:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                Children:
                  - Page.Title_3:
                      Control: Label
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height * 0.5
                        Size: =FontSizes.XLarge
                        Text: ="Quản lý người dùng"
                        Width: =Parent.Width * 0.5
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.25
                  - Add.User.Button:
                          Control: Classic/Button
                          Properties:
                            BorderColor: =Colors.Primary
                            BorderThickness: =1
                            Color: =Styles.Button.Primary.Color
                            DisplayMode: =DisplayMode.Edit
                            Fill: =Styles.Button.Primary.Fill
                            Height: =Styles.Button.Height
                            HoverFill: =Styles.Button.Primary.HoverFill
                            OnSelect: |
                              =Set(varFormMode, "Add");
                              Set(varEditingUser, Blank());
                              Reset('User.Add.Edit.Form');
                              Set(varShowUserForm, true)
                            PressedFill: =ColorFade(Styles.Button.Primary.Fill, -10%)
                            Size: =FontSizes.Medium
                            Text: ="+ Thêm người dùng"
                            Width: =Parent.Width * 0.2
                            X: =Parent.Width - Parent.Width * 0.25
                            Y: =Parent.Height * 0.2
            - Users.List.Section:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.88
                  Width: =Parent.Width
                  Y: =86.15999999999997
                Children:
                  - Search.Filter.Bar:
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =Colors.BorderLight
                        BorderThickness: =1
                        Fill: =Colors.White
                        Height: =If(Parent.Width < 768, Parent.Height * 0.22, Parent.Height * 0.08)
                        Width: =Parent.Width * 0.94
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.02
                      Children:
                        - Search.Input_1:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =If(IsBlank(Self.Text), Colors.Border, Colors.Success)
                              BorderThickness: =1
                              Color: =Colors.TextPrimary
                              Default: =""
                              FocusedBorderColor: =Colors.Primary
                              Height: =Parent.Height * 0.6
                              HintText: ="Tìm kiếm theo tên hoặc email..."
                              OnChange: |
                                =Set(varSearchText, Self.Text)
                              Size: =FontSizes.Base
                              Width: =If(Parent.Width < 768, Parent.Width * 0.9, Parent.Width * 0.35)
                              X: =Parent.Width * 0.02
                              Y: =Parent.Height * 0.2
                        - Department.Filter_1:
                            Control: Classic/DropDown
                            Properties:
                              BorderColor: =Colors.Border
                              Default: ="Tất cả"
                              Fill: =Colors.White
                              Height: =Parent.Height * 0.6
                              Items: =colDepartmentsWithAll
                              Items.Value: =Value
                              OnChange: |
                                =Set(varSelectedDepartment, If(Self.Selected.Value = "Tất cả", "", Self.Selected.Value))
                              Width: =If(Parent.Width < 768, Parent.Width * 0.42, Parent.Width * 0.18)
                              X: =If(Parent.Width < 768, Parent.Width * 0.02, Parent.Width * 0.39)
                              Y: =If(Parent.Width < 768, Parent.Height * 1.2, Parent.Height * 0.2)
                        - Role.Filter:
                            Control: Classic/DropDown
                            Properties:
                              BorderColor: =Colors.Border
                              Default: ="Tất cả"
                              Fill: =Colors.White
                              Height: =Parent.Height * 0.6
                              Items: =colRolesWithAll
                              Items.Value: =Value
                              OnChange: |
                                =Set(varSelectedRole, If(Self.Selected.Value = "Tất cả", "", Self.Selected.Value))
                              Width: =If(Parent.Width < 768, Parent.Width * 0.42, Parent.Width * 0.15)
                              X: =If(Parent.Width < 768, Parent.Width * 0.48, Parent.Width * 0.6)
                              Y: =If(Parent.Width < 768, Parent.Height * 1.2, Parent.Height * 0.2)
                        - View.Selected.Button:
                            Control: Classic/Button
                            Properties:
                              BorderColor: =Colors.Success
                              Color: =Colors.Success
                              DisplayMode: =If(IsBlank('Users.DataTable'.Selected), DisplayMode.Disabled, DisplayMode.Edit)
                              Fill: =RGBA(0, 0, 0, 0)
                              Height: =Parent.Height * 0.6
                              OnSelect: |
                                =If(Not(IsBlank('Users.DataTable'.Selected)),
                                  Set(varSelectedUser, 'Users.DataTable'.Selected);
                                  Set(varShowUserDetail, true);
                                  Set(varDetailFormMode, "View")
                                )
                              Size: =FontSizes.Small
                              Text: "=If(IsBlank('Users.DataTable'.Selected), \"Chọn\", \"Xem\")"
                              Width: =If(Parent.Width < 768, Parent.Width * 0.45, Parent.Width * 0.08)
                              X: =If(Parent.Width < 768, Parent.Width * 0.02, Parent.Width * 0.78)
                              Y: =If(Parent.Width < 768, Parent.Height * 2.4, Parent.Height * 0.2)
                        - Delete.Selected.Button:
                            Control: Classic/Button
                            Properties:
                              BorderColor: =Colors.Error
                              Color: =Colors.Error
                              DisplayMode: =If(Or(IsBlank('Users.DataTable'.Selected), 'Users.DataTable'.Selected.email = User().Email), DisplayMode.Disabled, DisplayMode.Edit)
                              Fill: =RGBA(0, 0, 0, 0)
                              Height: =Parent.Height * 0.6
                              OnSelect: |
                                =If(
                                  And(
                                    Not(IsBlank('Users.DataTable'.Selected)), 
                                    'Users.DataTable'.Selected.email <> User().Email
                                  ),
                                  Set(varSelectedUser, 'Users.DataTable'.Selected);
                                  Set(varDeleteConfirm, true),
                                  If(
                                    'Users.DataTable'.Selected.email = User().Email,
                                    Notify("Không thể xóa tài khoản hiện tại của bạn", NotificationType.Warning)
                                  )
                                )
                              Size: =FontSizes.Small
                              Text: ="Xóa"
                              Width: =If(Parent.Width < 768, Parent.Width * 0.45, Parent.Width * 0.08)
                              X: =If(Parent.Width < 768, Parent.Width * 0.5, Parent.Width * 0.88)
                              Y: =If(Parent.Width < 768, Parent.Height * 2.4, Parent.Height * 0.2)
                  - Users.Data.Table:
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =Colors.BorderLight
                        BorderThickness: =1
                        Fill: =Colors.White
                        Height: =Parent.Height * 0.85
                        Width: =Parent.Width * 0.94
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.12
                      Children:
                        - DataTable.Selection.Handler:
                            Control: Rectangle
                            Properties:
                              Fill: =RGBA(0, 0, 0, 0)
                              Height: =Parent.Height - 40
                              OnSelect: |
                                =If(Not(IsBlank('Users.DataTable'.Selected)),
                                    Set(varSelectedUser, 'Users.DataTable'.Selected);
                                    Set(varContextMenuX, 200);
                                    Set(varContextMenuY, 300);
                                    Set(varShowContextMenu, true)
                                )
                              Width: =Parent.Width - 40
                        - User.Context.Menu:
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =1
                              Fill: =Colors.White
                              Height: =120
                              Visible: =varShowContextMenu
                              Width: =150
                              X: =Min(varContextMenuX, Parent.Width - 150)
                              Y: =Min(varContextMenuY, Parent.Height - 120)
                            Children:
                              - View.Context.Button:
                                  Control: Classic/Button
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =Colors.TextPrimary
                                    Fill: =RGBA(0, 0, 0, 0)
                                    HoverFill: =Colors.BackgroundLight
                                    OnSelect: |
                                      =Set(varShowUserDetail, true);
                                      Set(varDetailFormMode, "View");
                                      Set(varShowContextMenu, false)
                                    Size: =FontSizes.Base
                                    Text: "=\"\U0001F441 Xem chi tiết\""
                                    Width: =Parent.Width
                              - Edit.Context.Button:
                                  Control: Classic/Button
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =Colors.TextPrimary
                                    Fill: =RGBA(0, 0, 0, 0)
                                    HoverFill: =Colors.BackgroundLight
                                    OnSelect: |
                                      =Set(varEditingUser, varSelectedUser);
                                      Set(varFormMode, "Edit");
                                      Set(varShowUserForm, true);
                                      Set(varShowContextMenu, false)
                                    Size: =FontSizes.Base
                                    Text: ="✎ Chỉnh sửa"
                                    Width: =Parent.Width
                                    Y: =40
                              - Delete.Context.Button:
                                      Control: Classic/Button
                                      Properties:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        Color: =Colors.Error
                                        Fill: =RGBA(0, 0, 0, 0)
                                        HoverFill: =Colors.BackgroundLight
                                        OnSelect: |
                                          =If(
                                            varSelectedUser.email = User().Email,
                                            Notify("Không thể xóa tài khoản hiện tại của bạn", NotificationType.Warning),
                                            Set(varDeleteConfirm, true);
                                            Set(varShowContextMenu, false)
                                          )
                                        Size: =FontSizes.Base
                                        Text: "=\"\U0001F5D1 Xóa\""
                                        Visible: =varSelectedUser.email <> User().Email
                                        Width: =Parent.Width
                                        Y: =80
      - Users.DataTable:
          Control: DataTable
          Properties:
            BorderColor: =RGBA(0, 0, 0, 0)
            Color: =RGBA(50, 49, 48, 1)
            Fill: =RGBA(255, 255, 255, 1)
            Font: =Font.'Segoe UI'
            HeadingColor: =RGBA(255, 255, 255, 1)
            HeadingFill: =RGBA(0, 120, 212, 1)
            HeadingFont: =Font.'Segoe UI'
            Height: =517
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =RGBA(0, 120, 212, 0.1)
            Items: |-
              =Filter(colUsers, 
                  And( 
                  Or( IsBlank(varSearchText), varSearchText in fullname, varSearchText in email ), 
                  Or( IsBlank(varSelectedDepartment), varSelectedDepartment = "Tất cả", Department = varSelectedDepartment ), 
                  Or( IsBlank(varSelectedRole), varSelectedRole = "Tất cả", Role = varSelectedRole ) 
                  ) 
                  )
            NoDataText: ="Không tìm thấy dữ liệu để hiển thị"
            SelectedColor: =RGBA(50, 49, 48, 1)
            SelectedFill: =RGBA(199, 224, 244, 1)
            Width: =1066
            X: =260
            Y: =215
          Children:
            - FullName.Column:
                Control: DataTableColumn
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Họ và tên"
                  FieldName: ="fullname"
                  Order: =1
                  Text: =ThisItem.fullname
                  Width: =200
            - Email.Column:
                Control: DataTableColumn
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Email"
                  FieldName: ="email"
                  Order: =2
                  Text: =ThisItem.email
                  Width: =250
            - JobTitle.Column:
                Control: DataTableColumn
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Chức vụ"
                  FieldName: ="jobTitle"
                  Order: =3
                  Text: =ThisItem.jobTitle
                  Width: =150
            - Phone.Column:
                Control: DataTableColumn
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Điện thoại"
                  FieldName: ="phone"
                  Order: =4
                  Text: =ThisItem.phone
                  Width: =120
            - Role.Column:
                Control: DataTableColumn
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Vai trò"
                  FieldName: ="Role"
                  Order: =5
                  Text: =ThisItem.Role
                  Width: =150
            - Status.Column:
                Control: DataTableColumn
                Variant: Textual
                Properties:
                  FieldDisplayName: ="Trạng thái"
                  FieldName: ="Status"
                  Order: =6
                  Text: =If(IsBlank(ThisItem.'Content approval status'), "Active", ThisItem.'Content approval status')
                  Width: =120
      - User.Form.Modal.Overlay:
          Control: Rectangle
          Properties:
            Fill: =Styles.Modal.Overlay
            Height: =Parent.Height
            OnSelect: |
              =Set(varShowUserForm, false)
            Visible: =varShowUserForm
            Width: =Parent.Width
      - User.Form.Modal:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            BorderColor: =If(varLoadingUsers, Colors.Primary, Colors.Border)
            BorderThickness: =If(varLoadingUsers, 3, 2)
            Fill: =Colors.White
            Height: =Min(Parent.Height * 0.7, 600)
            Visible: =varShowUserForm
            Width: =Min(Parent.Width * 0.5, 800)
            X: =If(varShowUserForm, (Parent.Width - Min(Parent.Width * 0.5, 800)) / 2, -Parent.Width * 2)
            Y: =If(varShowUserForm, (Parent.Height - Min(Parent.Height * 0.7, 600)) / 2, -Parent.Height * 2)
          Children:
            - Modal.Header_1:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.Primary
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                Children:
                  - Modal.Title_1:
                      Control: Label
                      Properties:
                        Color: =Colors.White
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        Size: =FontSizes.Large
                        Text: =If(varFormMode = "Add", "Thêm người dùng mới", "Chỉnh sửa thông tin người dùng")
                        Width: =Parent.Width * 0.8
                        X: =Parent.Width * 0.04
                        Y: =Parent.Height * 0.04
                  - Modal.Close.Button_1:
                          Control: Classic/Button
                          Properties:
                            BorderColor: =Colors.White
                            Color: =Colors.White
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =Parent.Height * 0.6
                            OnSelect: |
                              =Set(varShowUserForm, false);
                              Reset('User.Add.Edit.Form');
                              Set(varFormMode, "Add");
                              Set(varEditingUser, Blank());
                              Set(varErrorMessage, "")
                            Size: =FontSizes.Large
                            Text: ="×"
                            Width: =Parent.Height * 0.6
                            X: =Parent.Width * 0.9
                            Y: =Parent.Height * 0.2
            - Form.Content_1:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.76
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.12
                Children:
                  - User.Add.Edit.Form:
                      Control: Form
                      Variant: Classic
                      Layout: Vertical
                      Properties:
                        DataSource: =User_1
                        DefaultMode: =If(varFormMode = "Add", FormMode.New, FormMode.Edit)
                        Fill: =Colors.White
                        Height: =Parent.Height
                        Item: =If(varFormMode = "Edit", varEditingUser, Defaults(User_1))
                        OnFailure: |
                          =Notify("Có lỗi khi lưu dữ liệu", NotificationType.Error)
                        OnReset: |
                          =Set(varFormMode, "Add"); Set(varEditingUser, Blank())
                        OnSuccess: |-
                          =// After successful form submission, handle UserRole relationship
                          If(varFormMode = "Add",
                            // For new users, create UserRole mapping
                            If(Not(IsBlank(DataCardValue6.Selected)),
                              Patch(UserRole, Defaults(UserRole), {
                                userID: {
                                  Id: 'User.Add.Edit.Form'.LastSubmit.ID,
                                  Value: 'User.Add.Edit.Form'.LastSubmit.userID
                                },
                                roleID: {
                                  Id: DataCardValue6.Selected.ID,
                                  Value: DataCardValue6.Selected.name
                                }
                              })
                            ),
                            // For edit mode, update existing UserRole
                            If(Not(IsBlank(DataCardValue6.Selected)),
                              Patch(
                                UserRole, 
                                LookUp(UserRole, userID.Value = varEditingUser.userID), 
                                {
                                  roleID: {
                                    Id: DataCardValue6.Selected.ID,
                                    Value: DataCardValue6.Selected.name
                                  }
                                }
                              )
                            )
                          );

                          // Refresh collections after successful submission
                          ClearCollect(colUsersRaw, User_1);
                          ClearCollect(
                            colUsersWithDept,
                            AddColumns(
                              colUsersRaw,
                              Department,
                              LookUp(colDepartments, departmentID = ThisRecord.departmentID).name
                            )
                          );
                          ClearCollect(
                            colUsers,
                            AddColumns(
                              colUsersWithDept,
                              Role,
                              LookUp(
                                colRoles,
                                roleID = LookUp(colUserRoles, userID.Value = ThisRecord.userID.Value).roleID.Value
                              ).name
                            )
                          );

                          // Close form and show success message
                          Set(varShowUserForm, false);
                          Notify(
                            If(varFormMode = "Add", 
                              "Đã thêm người dùng thành công!", 
                              "Đã cập nhật thông tin thành công!"
                            ), 
                            NotificationType.Success
                          )
                        Width: =Parent.Width
                      Children:
                        - fullname_DataCard:
                            Control: TypedDataCard
                            Variant: ClassicTextualEdit
                            IsLocked: true
                            Properties:
                              BorderColor: =RGBA(245, 245, 245, 1)
                              DataField: ="fullname"
                              Default: =If(varFormMode = "Edit", varEditingUser.fullname, "")
                              DisplayName: ="Họ và tên"
                              MaxLength: =DataSourceInfo(User_1, DataSourceInfo.MaxLength, fullname)
                              Required: =true
                              Update: =DataCardValue1.Text
                              Width: =266
                              X: =0
                              Y: =0
                            Children:
                              - DataCardKey1:
                                  Control: Label
                                  MetadataKey: FieldName
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                              - DataCardValue1:
                                  Control: Classic/TextInput
                                  MetadataKey: FieldValue
                                  Properties:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =Parent.Default
                                    DelayOutput: =true
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Font: =Font.'Segoe UI'
                                    HintText: ="Nhập họ và tên"
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(255, 255, 255, 1)
                                    PaddingLeft: =5
                                    PressedBorderColor: =RGBA(0, 120, 212, 1)
                                    PressedColor: =RGBA(50, 49, 48, 1)
                                    PressedFill: =RGBA(255, 255, 255, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey1.Y + DataCardKey1.Height + 5
                              - ErrorMessage1:
                                  Control: Label
                                  MetadataKey: ErrorMessage
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue1.Y + DataCardValue1.Height
                              - StarVisible1:
                                  Control: Label
                                  MetadataKey: FieldRequired
                                  Properties:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey1.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey1.Y
                        - email_DataCard:
                            Control: TypedDataCard
                            Variant: ClassicTextualEdit
                            IsLocked: true
                            Properties:
                              BorderColor: =RGBA(245, 245, 245, 1)
                              DataField: ="email"
                              Default: =If(varFormMode = "Edit", varEditingUser.email, "")
                              DisplayName: ="Email"
                              MaxLength: =DataSourceInfo(User_1, DataSourceInfo.MaxLength, email)
                              Required: =true
                              Update: =DataCardValue2.Text
                              Width: =266
                              X: =280
                              Y: =0
                            Children:
                              - DataCardKey2:
                                  Control: Label
                                  MetadataKey: FieldName
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                              - DataCardValue2:
                                  Control: Classic/TextInput
                                  MetadataKey: FieldValue
                                  Properties:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =Parent.Default
                                    DelayOutput: =true
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Font: =Font.'Segoe UI'
                                    HintText: ="Nhập email"
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(255, 255, 255, 1)
                                    PaddingLeft: =5
                                    PressedBorderColor: =RGBA(0, 120, 212, 1)
                                    PressedColor: =RGBA(50, 49, 48, 1)
                                    PressedFill: =RGBA(255, 255, 255, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey2.Y + DataCardKey2.Height + 5
                              - ErrorMessage2:
                                  Control: Label
                                  MetadataKey: ErrorMessage
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue2.Y + DataCardValue2.Height
                              - StarVisible2:
                                  Control: Label
                                  MetadataKey: FieldRequired
                                  Properties:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey2.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey2.Y
                        - departmentID_DataCard:
                            Control: TypedDataCard
                            Variant: ClassicComboBoxEdit
                            IsLocked: true
                            Properties:
                              BorderColor: =RGBA(245, 245, 245, 1)
                              DataField: ="departmentID"
                              Default: =If(varFormMode = "Edit", LookUp(Department_1, name = varEditingUser.Department), First(Department_1))
                              DisplayName: ="Phòng ban"
                              Required: =true
                              Update: =DataCardValue3.Selected
                              Width: =266
                              X: =0
                              Y: =100
                            Children:
                              - DataCardKey3:
                                  Control: Label
                                  MetadataKey: FieldName
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                              - DataCardValue3:
                                  Control: Classic/ComboBox
                                  MetadataKey: FieldValue
                                  Properties:
                                    BorderColor: =If(IsBlank(Self.Selected), RGBA(245, 245, 245, 1), RGBA(0, 118, 184, 1))
                                    BorderStyle: =BorderStyle.Solid
                                    BorderThickness: =1
                                    Color: =RGBA(76, 75, 74, 1)
                                    DefaultSelectedItems: =If(varFormMode = "Edit", [Parent.Default], [First(Department_1)])
                                    DisplayFields: =["name"]
                                    DisplayMode: =Parent.DisplayMode
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Normal
                                    Height: =40
                                    HoverBorderColor: =RGBA(0, 118, 184, 1)
                                    HoverFill: =RGBA(245, 245, 245, 0.4)
                                    InputTextPlaceholder: ="Chọn phòng ban"
                                    Items: =Department_1
                                    PaddingLeft: =10
                                    PaddingRight: =10
                                    PressedBorderColor: =RGBA(0, 118, 184, 1)
                                    PressedFill: =RGBA(245, 245, 245, 0.8)
                                    Reset: =Parent.Reset
                                    SearchFields: =["name"]
                                    SelectionColor: =RGBA(0, 118, 184, 0.2)
                                    SelectMultiple: =false
                                    Size: =FontSizes.Medium
                                    TabIndex: =Parent.TabIndex
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey3.Y + DataCardKey3.Height + 5
                              - ErrorMessage3:
                                  Control: Label
                                  MetadataKey: ErrorMessage
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue3.Y + DataCardValue3.Height
                              - StarVisible3:
                                  Control: Label
                                  MetadataKey: FieldRequired
                                  Properties:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey3.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey3.Y
                        - jobTitle_DataCard:
                            Control: TypedDataCard
                            Variant: ClassicTextualEdit
                            IsLocked: true
                            Properties:
                              BorderColor: =RGBA(245, 245, 245, 1)
                              DataField: ="jobTitle"
                              Default: =If(varFormMode = "Edit", varEditingUser.jobTitle, "")
                              DisplayName: ="Chức vụ"
                              MaxLength: =DataSourceInfo(User_1, DataSourceInfo.MaxLength, jobTitle)
                              Required: =true
                              Update: =DataCardValue4.Text
                              Width: =266
                              X: =280
                              Y: =100
                            Children:
                              - DataCardKey4:
                                  Control: Label
                                  MetadataKey: FieldName
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                              - DataCardValue4:
                                  Control: Classic/TextInput
                                  MetadataKey: FieldValue
                                  Properties:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =Parent.Default
                                    DelayOutput: =true
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Font: =Font.'Segoe UI'
                                    HintText: ="Nhập chức vụ"
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(255, 255, 255, 1)
                                    PaddingLeft: =5
                                    PressedBorderColor: =RGBA(0, 120, 212, 1)
                                    PressedColor: =RGBA(50, 49, 48, 1)
                                    PressedFill: =RGBA(255, 255, 255, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey4.Y + DataCardKey4.Height + 5
                              - ErrorMessage4:
                                  Control: Label
                                  MetadataKey: ErrorMessage
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue4.Y + DataCardValue4.Height
                              - StarVisible4:
                                  Control: Label
                                  MetadataKey: FieldRequired
                                  Properties:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey4.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey4.Y
                        - phone_DataCard:
                            Control: TypedDataCard
                            Variant: ClassicTextualEdit
                            IsLocked: true
                            Properties:
                              BorderColor: =RGBA(245, 245, 245, 1)
                              DataField: ="phone"
                              Default: =If(varFormMode = "Edit", varEditingUser.phone, "")
                              DisplayName: ="Số điện thoại"
                              MaxLength: =DataSourceInfo(User_1, DataSourceInfo.MaxLength, phone)
                              Required: =true
                              Update: =DataCardValue5.Text
                              Width: =266
                              X: =0
                              Y: =200
                            Children:
                              - DataCardKey5:
                                  Control: Label
                                  MetadataKey: FieldName
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                              - DataCardValue5:
                                  Control: Classic/TextInput
                                  MetadataKey: FieldValue
                                  Properties:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =Parent.Default
                                    DelayOutput: =true
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Font: =Font.'Segoe UI'
                                    Format: =TextFormat.Number
                                    HintText: ="Nhập số điện thoại"
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(255, 255, 255, 1)
                                    PaddingLeft: =5
                                    PressedBorderColor: =RGBA(0, 120, 212, 1)
                                    PressedColor: =RGBA(50, 49, 48, 1)
                                    PressedFill: =RGBA(255, 255, 255, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey5.Y + DataCardKey5.Height + 5
                              - ErrorMessage5:
                                  Control: Label
                                  MetadataKey: ErrorMessage
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue5.Y + DataCardValue5.Height
                              - StarVisible5:
                                  Control: Label
                                  MetadataKey: FieldRequired
                                  Properties:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey5.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey5.Y
                        - roleID_DataCard:
                            Control: TypedDataCard
                            Variant: ClassicComboBoxEdit
                            IsLocked: true
                            Properties:
                              BorderColor: =RGBA(245, 245, 245, 1)
                              DataField: ="roleID"
                              Default: =If(varFormMode = "Edit", LookUp(Role_1, name = varEditingUser.Role), First(Role_1))
                              DisplayName: ="Vai trò"
                              Required: =true
                              Update: =DataCardValue6.Selected
                              Width: =266
                              X: =280
                              Y: =200
                            Children:
                              - DataCardKey6:
                                  Control: Label
                                  MetadataKey: FieldName
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                              - DataCardValue6:
                                  Control: Classic/ComboBox
                                  MetadataKey: FieldValue
                                  Properties:
                                    BorderColor: =If(IsBlank(Self.Selected), RGBA(245, 245, 245, 1), RGBA(0, 118, 184, 1))
                                    BorderStyle: =BorderStyle.Solid
                                    BorderThickness: =1
                                    Color: =RGBA(76, 75, 74, 1)
                                    DefaultSelectedItems: =If(varFormMode = "Edit", [Parent.Default], [First(Role_1)])
                                    DisplayFields: =["name"]
                                    DisplayMode: =Parent.DisplayMode
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Normal
                                    Height: =40
                                    HoverBorderColor: =RGBA(0, 118, 184, 1)
                                    HoverFill: =RGBA(245, 245, 245, 0.4)
                                    InputTextPlaceholder: ="Chọn vai trò"
                                    Items: =Role_1
                                    PaddingLeft: =10
                                    PaddingRight: =10
                                    PressedBorderColor: =RGBA(0, 118, 184, 1)
                                    PressedFill: =RGBA(245, 245, 245, 0.8)
                                    Reset: =Parent.Reset
                                    SearchFields: =["name"]
                                    SelectionColor: =RGBA(0, 118, 184, 0.2)
                                    SelectMultiple: =false
                                    Size: =FontSizes.Medium
                                    TabIndex: =Parent.TabIndex
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey6.Y + DataCardKey6.Height + 5
                              - ErrorMessage6:
                                  Control: Label
                                  MetadataKey: ErrorMessage
                                  Properties:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue6.Y + DataCardValue6.Height
                              - StarVisible6:
                                  Control: Label
                                  MetadataKey: FieldRequired
                                  Properties:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey6.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey6.Y
            - Form.Footer_1:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  BorderColor: =Colors.BorderLight
                  BorderThickness: =1
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.88
                Children:
                      - Cancel.Button_1:
                          Control: Classic/Button
                          Properties:
                            BorderColor: =Colors.Border
                            Color: =Styles.Button.Secondary.Color
                            Fill: =Styles.Button.Secondary.Fill
                            Height: =Styles.Button.Height
                            HoverFill: =Styles.Button.Secondary.HoverFill
                            OnSelect: |-
                              =Reset('User.Add.Edit.Form');
                              Set(varShowUserForm, false);
                              Set(varFormMode, "Add");
                              Set(varEditingUser, Blank());
                              Set(varErrorMessage, "")
                            Size: =FontSizes.Medium
                            Text: ="Hủy"
                            Width: =Parent.Width * 0.15
                            X: =Parent.Width * 0.55
                            Y: =Parent.Height * 0.2
                      - Save.Button_1:
                          Control: Classic/Button
                          Properties:
                            BorderColor: =Colors.Primary
                            Color: =Styles.Button.Primary.Color
                            DisplayMode: =If('User.Add.Edit.Form'.Valid, DisplayMode.Edit, DisplayMode.Disabled)
                            Fill: =Styles.Button.Primary.Fill
                            Height: =Styles.Button.Height
                            HoverFill: =Styles.Button.Primary.HoverFill
                            OnSelect: |-
                              =// Validate required fields before submission
                              If(
                                And(
                                  Not(IsBlank(DataCardValue1.Text)),
                                  Not(IsBlank(DataCardValue2.Text)),
                                  Not(IsBlank(DataCardValue3.Selected)),
                                  Not(IsBlank(DataCardValue4.Text)),
                                  Not(IsBlank(DataCardValue5.Text)),
                                  Not(IsBlank(DataCardValue6.Selected))
                                ),
                                // All fields valid, submit form
                                SubmitForm('User.Add.Edit.Form'),
                                // Show validation error
                                Notify("Vui lòng điền đầy đủ thông tin bắt buộc", NotificationType.Warning)
                              )
                            Size: =FontSizes.Medium
                            Text: =If(varFormMode = "Add", "Thêm người dùng", "Cập nhật")
                            Width: =150
                            X: =Parent.Width * 0.75
                            Y: =Parent.Height * 0.2
      - Delete.Modal.Overlay:
          Control: Rectangle
          Properties:
            Fill: =Styles.Modal.Overlay
            Height: =Parent.Height
            OnSelect: |
              =Set(varDeleteConfirm, false)
            Visible: =varDeleteConfirm
            Width: =Parent.Width
      - Delete.Confirmation.Modal:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            Fill: =Colors.White
            Height: =Parent.Height * 0.3
            Visible: =varDeleteConfirm
            Width: =Parent.Width * 0.4
            X: =If(varDeleteConfirm, (Parent.Width - Parent.Width * 0.4) / 2, -Parent.Width)
            Y: =If(varDeleteConfirm, (Parent.Height - Parent.Height * 0.3) / 2, -Parent.Height)
          Children:
            - Confirm.Header:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.Error
                  Height: =Parent.Height * 0.25
                  Width: =Parent.Width
                Children:
                  - Confirm.Title:
                      Control: Label
                      Properties:
                        Align: =Align.Center
                        Color: =Colors.White
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        Size: =FontSizes.Large
                        Text: ="Xác nhận xóa người dùng"
                        Width: =Parent.Width
            - Confirm.Content:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.5
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.25
                Children:
                  - Confirm.Message:
                      Control: Label
                      Properties:
                        Align: =Align.Center
                        Color: =Colors.TextPrimary
                        Height: =Parent.Height
                        Size: =FontSizes.Base
                        Text: =Concatenate("Bạn có chắc chắn muốn xóa người dùng ", varSelectedUser.fullname, "?")
                        Width: =Parent.Width * 0.9
                        X: =Parent.Width * 0.05
            - Confirm.Footer:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.25
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.75
                Children:
                  - Confirm.Cancel.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Styles.Button.Secondary.Color
                        Fill: =Styles.Button.Secondary.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Secondary.HoverFill
                        OnSelect: |
                          =Set(varDeleteConfirm, false)
                        Size: =FontSizes.Medium
                        Text: ="Hủy"
                        Width: =Parent.Width * 0.15
                        X: =Parent.Width * 0.3
                        Y: =Parent.Height * 0.2
                  - Confirm.Delete.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Error
                        Color: =Styles.Button.Danger.Color
                        Fill: =Styles.Button.Danger.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Danger.HoverFill
                        OnSelect: |
                          =If(
                            varSelectedUser.email = User().Email,
                            Notify("Không thể xóa tài khoản hiện tại của bạn", NotificationType.Error),
                            // Delete from SharePoint User_1
                            Remove(User_1, LookUp(User_1, email = varSelectedUser.email));

                            // Remove from UserRole table
                            RemoveIf(UserRole, userID.Value = varSelectedUser.email);

                            // Update collections
                            ClearCollect(colUsersRaw, User_1);
                            ClearCollect(
                              colUsersWithDept,
                              AddColumns(
                                colUsersRaw,
                                Department,
                                LookUp(colDepartments, departmentID = ThisRecord.departmentID).name
                              )
                            );
                            ClearCollect(
                              colUsers,
                              AddColumns(
                                colUsersWithDept,
                                Role,
                                LookUp(
                                  colRoles,
                                  roleID = LookUp(colUserRoles, userID.Value = ThisRecord.userID.Value).roleID.Value
                                ).name
                              )
                            );

                            Set(varDeleteConfirm, false);
                            Set(varSelectedUser, Blank());
                            Notify("Đã xóa người dùng thành công!", NotificationType.Success)
                          )
                        Size: =FontSizes.Medium
                        Text: ="Xóa"
                        Width: =Parent.Width * 0.15
                        X: =Parent.Width * 0.55
                        Y: =Parent.Height * 0.2
      - User.Detail.Modal.Overlay:
          Control: Rectangle
          Properties:
            Fill: =Styles.Modal.Overlay
            Height: =Parent.Height
            OnSelect: |
              =Set(varShowUserDetail, false)
            Visible: =varShowUserDetail
            Width: =Parent.Width
      - User.Detail.Modal:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            BorderColor: =Colors.Border
            BorderThickness: =2
            Fill: =Colors.White
            Height: =Min(Parent.Height * 0.7, 600)
            Visible: =varShowUserDetail
            Width: =Min(Parent.Width * 0.5, 800)
            X: =If(varShowUserDetail, (Parent.Width - Min(Parent.Width * 0.5, 800)) / 2, -Parent.Width * 2)
            Y: =If(varShowUserDetail, (Parent.Height - Min(Parent.Height * 0.7, 600)) / 2, -Parent.Height * 2)
          Children:
            - Detail.Modal.Header:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.Primary
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                Children:
                  - Detail.Modal.Title:
                      Control: Label
                      Properties:
                        Color: =Colors.White
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        Size: =FontSizes.Large
                        Text: ="Thông tin người dùng"
                        Width: =Parent.Width * 0.6
                        X: =Parent.Width * 0.04
                  - Edit.Toggle.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.White
                        Color: =Colors.White
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =Parent.Height * 0.6
                        OnSelect: |
                          =If(varDetailFormMode = "View",
                            Set(varDetailFormMode, "Edit");
                            Set(varErrorMessage, ""),
                            Set(varDetailFormMode, "View");
                            Set(varErrorMessage, "")
                          )
                        Size: =FontSizes.Medium
                        Text: =If(varDetailFormMode = "View", "Chỉnh sửa ✎", "Huỷ chỉnh sửa ✕")
                        Width: =Parent.Width * 0.25
                        X: =Parent.Width * 0.6
                        Y: =Parent.Height * 0.2
                  - Detail.Modal.Close.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.White
                        Color: =Colors.White
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =Parent.Height * 0.6
                        OnSelect: |
                          =Set(varShowUserDetail, false);
                          Set(varDetailFormMode, "View")
                        Size: =FontSizes.Large
                        Text: ="×"
                        Width: =Parent.Height * 0.6
                        X: =Parent.Width * 0.9
                        Y: =Parent.Height * 0.2
            - Detail.Form.Content:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.76
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.12
                Children:
                  - Detail.Form.Fields.Container:
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        Fill: =Colors.White
                        Height: =Parent.Height
                        Width: =Parent.Width
                      Children:
                        - Detail.FullName.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Họ và tên *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =20
                        - Detail.FullName.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.fullname
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =45
                        - Detail.FullName.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =Colors.Border
                              Default: =varSelectedUser.fullname
                              FocusedBorderColor: =Colors.Primary
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =45
                        - Detail.Email.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Email *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =20
                        - Detail.Email.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.email
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =45
                        - Detail.Email.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =Colors.Border
                              Default: =varSelectedUser.email
                              FocusedBorderColor: =Colors.Primary
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =45
                        - Detail.Department.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Phòng ban *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =95
                        - Detail.Department.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.Department
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =120
                        - Detail.Department.Dropdown:
                            Control: Classic/DropDown
                            Properties:
                              BorderColor: =Colors.Border
                              Default: =varSelectedUser.Department
                              FocusedBorderColor: =Colors.Primary
                              FocusedBorderThickness: =2
                              Height: =Styles.Input.Height
                              Items: =Department_1
                              Items.Value: =name
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =120
                        - Detail.JobTitle.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Chức vụ *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =95
                        - Detail.JobTitle.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.jobTitle
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =120
                        - Detail.JobTitle.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =Colors.Border
                              Default: =varSelectedUser.jobTitle
                              FocusedBorderColor: =Colors.Primary
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =120
                        - Detail.Phone.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Số điện thoại *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =170
                        - Detail.Phone.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.phone
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =195
                        - Detail.Phone.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =Colors.Border
                              Default: =varSelectedUser.phone
                              FocusedBorderColor: =Colors.Primary
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =195
                        - Detail.Role.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Vai trò *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =170
                        - Detail.Role.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.Role
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =195
                        - Detail.Role.Dropdown:
                            Control: Classic/DropDown
                            Properties:
                              BorderColor: =Colors.Border
                              Default: =varSelectedUser.Role
                              FocusedBorderColor: =Colors.Primary
                              FocusedBorderThickness: =2
                              Height: =Styles.Input.Height
                              Items: =Role_1
                              Items.Value: =name
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =195
                        - Detail.Error.Message:
                            Control: Label
                            Properties:
                              AutoHeight: =true
                              Color: =Colors.Error
                              FontWeight: =FontWeight.Semibold
                              Height: =30
                              Size: =FontSizes.Base
                              Text: =varErrorMessage
                              Visible: =Not(IsBlank(varErrorMessage)) && varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.9
                              X: =Parent.Width * 0.05
                              Y: =240
            - Detail.Form.Footer:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  BorderColor: =Colors.BorderLight
                  BorderThickness: =1
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.12
                  Visible: =varDetailFormMode = "Edit"
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.88
                Children:
                  - Detail.Cancel.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Styles.Button.Secondary.Color
                        Fill: =Styles.Button.Secondary.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Secondary.HoverFill
                        OnSelect: |
                          =Set(varDetailFormMode, "View");
                          Set(varErrorMessage, "")
                        Size: =FontSizes.Medium
                        Text: ="Huỷ"
                        Width: =Parent.Width * 0.15
                        X: =Parent.Width * 0.55
                        Y: =Parent.Height * 0.2
                  - Detail.Save.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Primary
                        Color: =Styles.Button.Primary.Color
                        Fill: =Styles.Button.Primary.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Primary.HoverFill
                        OnSelect: "=// Clear previous errors\nSet(varErrorMessage, \"\");\n\n// Create lookup objects for SharePoint\nSet(\n  varDepartmentLookup,\n  {\n    Id: LookUp(Department_1, name = 'Detail.Department.Dropdown'.Selected.name).ID,\n    Value: 'Detail.Department.Dropdown'.Selected.name\n  }\n);\nSet(\n  varRoleLookup,\n  {\n    Id: LookUp(Role_1, name = 'Detail.Role.Dropdown'.Selected.name).ID,\n    Value: 'Detail.Role.Dropdown'.Selected.name\n  }\n);\n\n// Update SharePoint data with error handling\nIfError(\n  // Update user information\n  Patch(\n    User_1,\n    LookUp(User_1, userID = varSelectedUser.userID),\n    {\n      fullname: 'Detail.FullName.Input'.Text,\n      email: 'Detail.Email.Input'.Text,\n      departmentID: varDepartmentLookup,\n      jobTitle: 'Detail.JobTitle.Input'.Text,\n      phone: 'Detail.Phone.Input'.Text\n    }\n  );\n  \n  // Update user role mapping if role changed\n  If(\n    Not(IsBlank(varRoleLookup)),\n    Patch(UserRole, LookUp(UserRole, userID.Value = varSelectedUser.userID), {\n      roleID: varRoleLookup\n    })\n  );\n  \n  // Refresh collections - Error Safe\n  IfError(\n    ClearCollect(colUsersRaw, User_1);\n    ClearCollect(\n      colUsersWithDept,\n      AddColumns(\n        colUsersRaw,\n        Department,\n        LookUp(colDepartments, departmentID = ThisRecord.departmentID).name\n      )\n    );\n    ClearCollect(\n      colUsers,\n      AddColumns(\n        colUsersWithDept,\n        Role,\n        LookUp(\n          colRoles,\n          roleID = LookUp(colUserRoles, userID.Value = ThisRecord.userID.Value).roleID.Value\n        ).name\n      )\n    ),\n    \n    // Fallback\n    ClearCollect(colUsers, User_1)\n  );\n  \n  // Update selected user with new data\n  Set(varSelectedUser, LookUp(colUsers, userID = varSelectedUser.userID));\n  Set(varDetailFormMode, \"View\");\n  Notify(\"Đã cập nhật thông tin người dùng thành công!\", NotificationType.Success),\n  \n  // Error handling\n  Set(varErrorMessage, \"Có lỗi khi cập nhật thông tin\")\n)\n"
                        Size: =FontSizes.Medium
                        Text: ="Lưu"
                        Width: =Parent.Width * 0.2
                        X: =Parent.Width * 0.75
                        Y: =Parent.Height * 0.2
      - Loading.Overlay_1:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            Fill: =RGBA(255, 255, 255, 0.8)
            Height: =Parent.Height
            Visible: =varLoadingUsers
            Width: =Parent.Width
          Children:
            - Loading.Spinner_1:
                Control: Classic/Icon
                Properties:
                  Color: =Colors.Primary
                  Height: =40
                  Icon: =Icon.Sync
                  Visible: =varLoadingUsers
                  Width: =40
                  X: =(Parent.Width - Self.Width) / 2
                  Y: =(Parent.Height - Self.Height) / 2
