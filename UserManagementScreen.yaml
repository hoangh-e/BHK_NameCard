Screens:
  UserManagementScreen:
    Properties:
      Fill: =Colors.BackgroundLight
      OnVisible: |
        =ClearCollect(colDepartments, 
          {Id: 1, Name: "Phòng Công nghệ thông tin"},
          {Id: 2, Name: "Phòng Kế toán"},
          {Id: 3, Name: "Phòng Nhân sự"},
          {Id: 4, Name: "Phòng Marketing"},
          {Id: 5, Name: "Ban Giám đốc"}
        );
        ClearCollect(colUsers,
          {Id: 1, FullName: "Nguyễn Văn An", Email: "an.nguyen@company.com", Department: "Phòng Công nghệ thông tin", JobTitle: "Trưởng phòng", Phone: "0901234567", Role: "Manager", Status: "Active"},
          {Id: 2, FullName: "Trần Thị Bình", Email: "binh.tran@company.com", Department: "Phòng Nhân sự", JobTitle: "Chuyên viên HR", Phone: "0901234568", Role: "HR", Status: "Active"},
          {Id: 3, FullName: "Lê Văn Cường", Email: "cuong.le@company.com", Department: "Phòng Kế toán", JobTitle: "Kế toán viên", Phone: "0901234569", Role: "Employee", Status: "Active"},
          {Id: 4, FullName: "Phạm Thị Dung", Email: "dung.pham@company.com", Department: "Phòng Marketing", JobTitle: "Giám đốc", Phone: "0901234570", Role: "Admin", Status: "Active"}
        );
        Set(varShowUserForm, false);
        Set(varFormMode, "Add");
        Set(varEditingUser, Blank());
        Set(varSelectedUser, Blank());
        Set(varDeleteConfirm, false);
        Set(varLoadingUsers, false);
        Set(varErrorMessage, "");
        Set(varShowUserDetail, false);
        Set(varDetailFormMode, "View");
        Set(varShowContextMenu, false);
        Set(varContextMenuX, 0);
        Set(varContextMenuY, 0)
    Children:
      - Main.Content.Container_3:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            Fill: =Colors.BackgroundLight
            Height: =Parent.Height - Styles.Header.Height
            Width: =Parent.Width - Styles.Navigation.Width
            X: =Styles.Navigation.Width
            Y: =Styles.Header.Height
          Children:
            - Page.Header.Section_3:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                Children:
                  - Page.Title_3:
                      Control: Label
                      Properties:
                        Color: =Colors.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height * 0.5
                        Size: =FontSizes.XLarge
                        Text: ="Quản lý người dùng"
                        Width: =Parent.Width * 0.5
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.25
                  - Add.User.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Primary
                        BorderThickness: =If(varLoadingUsers, 2, 1)
                        Color: =Styles.Button.Primary.Color
                        DisplayMode: =If(varLoadingUsers, DisplayMode.Disabled, DisplayMode.Edit)
                        Fill: =If(varLoadingUsers, ColorFade(Styles.Button.Primary.Fill, 30%), Styles.Button.Primary.Fill)
                        Height: =Styles.Button.Height
                        HoverFill: =If(varLoadingUsers, Styles.Button.Primary.Fill, Styles.Button.Primary.HoverFill)
                        OnSelect: |
                          =Set(varLoadingUsers, true);
                          Set(varFormMode, "Add");
                          Set(varLoadingUsers, false);
                          Set(varShowUserForm, true)
                        PressedFill: =ColorFade(Styles.Button.Primary.Fill, -10%)
                        Size: =FontSizes.Medium
                        Text: =If(varLoadingUsers, LoadingStates.Button.Text, "+ Thêm người dùng")
                        Width: =Parent.Width * 0.2
                        X: =Parent.Width - Parent.Width * 0.25
                        Y: =Parent.Height * 0.2
            - Users.List.Section:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.88
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.12
                Children:
                  - Search.Filter.Bar:
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =Colors.BorderLight
                        BorderThickness: =1
                        Fill: =Colors.White
                        Height: =Parent.Height * 0.08
                        Width: =Parent.Width * 0.94
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.02
                      Children:
                        - Search.Input_1:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, If(IsBlank(Self.Text), Colors.Border, Colors.Success))
                              BorderThickness: =If(Self.Focused, InteractionStates.Input.Focus.BorderWidth, InteractionStates.Input.Normal.BorderWidth)
                              Color: =Colors.TextPrimary
                              Default: =""
                              FocusedBorderColor: =Colors.Primary
                              Height: =Styles.Input.Height
                              HintText: ="Tìm kiếm theo tên hoặc email..."
                              OnChange: |
                                =Set(varSearchText, Self.Text)
                              Size: =FontSizes.Base
                              Width: =Parent.Width * 0.35
                              X: =Parent.Width * 0.02
                              Y: =Parent.Height * 0.2
                        - Department.Filter_1:
                            Control: Classic/ComboBox
                            Properties:
                              BorderColor: =Colors.Border
                              DefaultSelectedItems: |
                                =Table({Name: "Tất cả"})
                              Fill: =Colors.White
                              Height: =Styles.Input.Height
                              Items: |
                                =Table({Name: "Tất cả"}, {Name: "Phòng Công nghệ thông tin"}, {Name: "Phòng Kế toán"}, {Name: "Phòng Nhân sự"}, {Name: "Phòng Marketing"}, {Name: "Ban Giám đốc"})
                              OnChange: |
                                =Set(varSelectedDepartment, If(Self.Selected.Result.Name = "Tất cả", "", Self.Selected.Result.Name))
                              Width: =Parent.Width * 0.25
                              X: =Parent.Width * 0.4
                              Y: =Parent.Height * 0.2
                        - Role.Filter:
                            Control: Classic/ComboBox
                            Properties:
                              BorderColor: =Colors.Border
                              DefaultSelectedItems: |
                                =Table({Name: "Tất cả"})
                              Fill: =Colors.White
                              Height: =Styles.Input.Height
                              Items: |
                                =Table({Name: "Tất cả"}, {Name: "Employee"}, {Name: "Manager"}, {Name: "HR"}, {Name: "Admin"})
                              OnChange: |
                                =Set(varSelectedRole, If(Self.Selected.Result.Name = "Tất cả", "", Self.Selected.Result.Name))
                              Width: =Parent.Width * 0.15
                              X: =Parent.Width * 0.68
                              Y: =Parent.Height * 0.2
                  - Users.Data.Table:
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =Colors.BorderLight
                        BorderThickness: =1
                        Fill: =Colors.White
                        Height: =Parent.Height * 0.85
                        Width: =Parent.Width * 0.94
                        X: =Parent.Width * 0.03
                        Y: =Parent.Height * 0.12
                      Children:
                        - Users.DataTable:
                            Control: DataTable
                            Properties:
                              BorderColor: =RGBA(0, 0, 0, 0)
                              Color: =Colors.TextPrimary
                              Fill: =Colors.White
                              Font: =Font.'Segoe UI'
                              HeadingColor: =Colors.White
                              HeadingFill: =Colors.Primary
                              HeadingFont: =Font.'Segoe UI'
                              Height: =Parent.Height
                              HoverColor: =Colors.White
                              HoverFill: =ColorFade(Colors.Primary, 90%)
                              Items: |
                                =Filter(colUsers, 
                                  And(
                                    Or(IsBlank(varSearchText), varSearchText in FullName, varSearchText in Email),
                                    Or(IsBlank(varSelectedDepartment), Department = varSelectedDepartment),
                                    Or(IsBlank(varSelectedRole), Role = varSelectedRole)
                                  )
                                )
                              OnSelect: |
                                =Set(varSelectedUser, Self.Selected);
                                Set(varShowUserDetail, true);
                                Set(varDetailFormMode, "View")
                              SelectedColor: =Colors.TextPrimary
                              SelectedFill: =ColorFade(Colors.Primary, 85%)
                              Width: =Parent.Width
                            Children:
                              - FullName.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Họ và tên"
                                    FieldName: ="FullName"
                                    Order: =1
                                    Text: =ThisItem.FullName
                                    Width: =200
                              - Email.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Email"
                                    FieldName: ="Email"
                                    Order: =2
                                    Text: =ThisItem.Email
                                    Width: =250
                              - Department.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Phòng ban"
                                    FieldName: ="Department"
                                    Order: =3
                                    Text: =ThisItem.Department
                                    Width: =200
                              - JobTitle.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Chức vụ"
                                    FieldName: ="JobTitle"
                                    Order: =4
                                    Text: =ThisItem.JobTitle
                                    Width: =150
                              - Phone.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Điện thoại"
                                    FieldName: ="Phone"
                                    Order: =5
                                    Text: =ThisItem.Phone
                                    Width: =120
                              - Role.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Vai trò"
                                    FieldName: ="Role"
                                    Order: =6
                                    Text: =ThisItem.Role
                                    Width: =100
                              - Status.Column:
                                  Control: DataTableColumn
                                  Variant: Textual
                                  Properties:
                                    FieldDisplayName: ="Trạng thái"
                                    FieldName: ="Status"
                                    Order: =7
                                    Text: =ThisItem.Status
                                    Width: =100
                              - Actions.Column:
                                  Control: DataTableColumn
                                  Variant: Custom
                                  Properties:
                                    FieldDisplayName: ="Thao tác"
                                    FieldName: ="Actions"
                                    Order: =8
                                    Width: =120
                                  Children:
                                    - Edit.Action.Button:
                                        Control: Classic/Button
                                        Properties:
                                          BorderColor: =Colors.Primary
                                          Color: =Colors.Primary
                                          Fill: =RGBA(0, 0, 0, 0)
                                          Height: =30
                                          OnSelect: |
                                            =Set(varEditingUser, ThisItem);
                                            Set(varFormMode, "Edit");
                                            Set(varShowUserForm, true)
                                          Size: =FontSizes.Small
                                          Text: ="Sửa"
                                          Width: =50
                                          X: =5
                                          Y: =5
                                    - Delete.Action.Button:
                                        Control: Classic/Button
                                        Properties:
                                          BorderColor: =Colors.Error
                                          Color: =Colors.Error
                                          Fill: =RGBA(0, 0, 0, 0)
                                          Height: =30
                                          OnSelect: |
                                            =Set(varSelectedUser, ThisItem);
                                            Set(varDeleteConfirm, true)
                                          Size: =FontSizes.Small
                                          Text: ="Xóa"
                                          Width: =50
                                          X: =60
                                          Y: =5
                        - User.Context.Menu:
                            Control: GroupContainer
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =1
                              Fill: =Colors.White
                              Height: =120
                              Visible: =varShowContextMenu
                              Width: =150
                              X: =varContextMenuX
                              Y: =varContextMenuY
                            Children:
                              - View.Context.Button:
                                  Control: Classic/Button
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =Colors.TextPrimary
                                    Fill: =RGBA(0, 0, 0, 0)
                                    Height: =40
                                    HoverFill: =Colors.BackgroundLight
                                    OnSelect: |
                                      =Set(varShowUserDetail, true);
                                      Set(varDetailFormMode, "View");
                                      Set(varShowContextMenu, false)
                                    Size: =FontSizes.Base
                                    Text: ="👁 Xem chi tiết"
                                    Width: =Parent.Width
                              - Edit.Context.Button:
                                  Control: Classic/Button
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =Colors.TextPrimary
                                    Fill: =RGBA(0, 0, 0, 0)
                                    Height: =40
                                    HoverFill: =Colors.BackgroundLight
                                    OnSelect: |
                                      =Set(varEditingUser, varSelectedUser);
                                      Set(varFormMode, "Edit");
                                      Set(varShowUserForm, true);
                                      Set(varShowContextMenu, false)
                                    Size: =FontSizes.Base
                                    Text: ="✎ Chỉnh sửa"
                                    Width: =Parent.Width
                                    Y: =40
                              - Delete.Context.Button:
                                  Control: Classic/Button
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =Colors.Error
                                    Fill: =RGBA(0, 0, 0, 0)
                                    Height: =40
                                    HoverFill: =Colors.BackgroundLight
                                    OnSelect: |
                                      =Set(varDeleteConfirm, true);
                                      Set(varShowContextMenu, false)
                                    Size: =FontSizes.Base
                                    Text: ="🗑 Xóa"
                                    Width: =Parent.Width
                                    Y: =80
 
      - User.Form.Modal.Overlay:
          Control: Rectangle
          Properties:
            Fill: =Styles.Modal.Overlay
            Height: =Parent.Height
            OnSelect: |
              =Set(varShowUserForm, false)
            Visible: =varShowUserForm
            Width: =Parent.Width
      - User.Form.Modal:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            BorderColor: =If(varLoadingUsers, Colors.Primary, Colors.Border)
            BorderThickness: =If(varLoadingUsers, 3, 2)
            Fill: =Colors.White
            Height: =Parent.Height * 0.7
            Visible: =varShowUserForm
            Width: =Parent.Width * 0.5
            X: =If(varShowUserForm, (Parent.Width - Parent.Width * 0.5) / 2, -Parent.Width * 2)
            Y: =If(varShowUserForm, (Parent.Height - Parent.Height * 0.7) / 2, -Parent.Height * 2)
          Children:
            - Modal.Header_1:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.Primary
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                Children:
                  - Modal.Title_1:
                      Control: Label
                      Properties:
                        Color: =Colors.White
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        Size: =FontSizes.Large
                        Text: =If(varFormMode = "Add", "Thêm người dùng mới", "Chỉnh sửa thông tin người dùng")
                        Width: =Parent.Width * 0.8
                        X: =Parent.Width * 0.04
                  - Modal.Close.Button_1:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.White
                        Color: =Colors.White
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =Parent.Height * 0.6
                        OnSelect: |
                          =Set(varShowUserForm, false)
                        Size: =FontSizes.Large
                        Text: ="×"
                        Width: =Parent.Height * 0.6
                        X: =Parent.Width * 0.9
                        Y: =Parent.Height * 0.2
            - Form.Content_1:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.76
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.12
                Children:
                  - Form.Fields.Container:
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        Fill: =Colors.White
                        Height: =Parent.Height
                        Width: =Parent.Width
                      Children:
                        - FullName.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Họ và tên *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =0
                        - FullName.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              Default: =If(varFormMode = "Edit", varEditingUser.FullName, "")
                              Height: =Styles.Input.Height
                              HintText: ="Nhập họ và tên"
                              Size: =FontSizes.Base
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =20
                        - Email.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Email *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =0
                        - Email.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              Default: =If(varFormMode = "Edit", varEditingUser.Email, "")
                              Height: =Styles.Input.Height
                              HintText: ="Nhập email"
                              Size: =FontSizes.Base
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =20
                        - Department.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Phòng ban *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =70
                        - Department.Dropdown:
                            Control: Classic/ComboBox
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              DefaultSelectedItems: |
                                =If(varFormMode = "Edit", 
                                Filter(Table({Name: "Phòng Công nghệ thông tin"}, {Name: "Phòng Kế toán"}, {Name: "Phòng Nhân sự"}, {Name: "Phòng Marketing"}, {Name: "Ban Giám đốc"}), Name = varEditingUser.Department),
                                Blank()
                                )
                              Height: =Styles.Input.Height
                              Items: |
                                =Table({Name: "Phòng Công nghệ thông tin"}, {Name: "Phòng Kế toán"}, {Name: "Phòng Nhân sự"}, {Name: "Phòng Marketing"}, {Name: "Ban Giám đốc"})
                              Size: =FontSizes.Base
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =90
                        - JobTitle.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Chức vụ *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =70
                        - JobTitle.Input_1:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              Default: =If(varFormMode = "Edit", varEditingUser.JobTitle, "")
                              Height: =Styles.Input.Height
                              HintText: ="Nhập chức vụ"
                              Size: =FontSizes.Base
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =90
                        - Phone.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Số điện thoại *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =140
                        - Phone.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              Default: =If(varFormMode = "Edit", varEditingUser.Phone, "")
                              Height: =Styles.Input.Height
                              HintText: ="Nhập số điện thoại"
                              Size: =FontSizes.Base
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =160
                        - Role.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Vai trò *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =140
                        - Role.Dropdown:
                            Control: Classic/ComboBox
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              DefaultSelectedItems: |
                                =If(varFormMode = "Edit",
                                Filter(Table({Name: "Employee"}, {Name: "Manager"}, {Name: "HR"}, {Name: "Admin"}), Name = varEditingUser.Role),
                                Table({Name: "Employee"})
                                )
                              Height: =Styles.Input.Height
                              Items: |
                                =Table({Name: "Employee"}, {Name: "Manager"}, {Name: "HR"}, {Name: "Admin"})
                              Size: =FontSizes.Base
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =160
            - Form.Footer_1:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  BorderColor: =Colors.BorderLight
                  BorderThickness: =1
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.88
                Children:
                  - Cancel.Button_1:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Styles.Button.Secondary.Color
                        Fill: =Styles.Button.Secondary.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Secondary.HoverFill
                        OnSelect: |
                          =Set(varShowUserForm, false)
                        Size: =FontSizes.Medium
                        Text: ="Hủy"
                        Width: =Parent.Width * 0.15
                        X: =Parent.Width * 0.55
                        Y: =Parent.Height * 0.2
                  - Save.Button_1:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Primary
                        Color: =Styles.Button.Primary.Color
                        DisplayMode: |
                          =If(And(
                            Not(IsBlank('FullName.Input'.Text)), 
                            Not(IsBlank('Email.Input'.Text)), 
                            Not(IsBlank('Department.Dropdown'.Selected.Name)), 
                            Not(IsBlank('JobTitle.Input_1'.Text)), 
                            Not(IsBlank('Phone.Input'.Text))
                          ), DisplayMode.Edit, DisplayMode.Disabled)
                        Fill: =Styles.Button.Primary.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Primary.HoverFill
                        OnSelect: |
                          =If(varFormMode = "Add",
                            Collect(colUsers, {
                              Id: Max(colUsers, Id) + 1,
                              FullName: 'FullName.Input'.Text,
                              Email: 'Email.Input'.Text,
                              Department: 'Department.Dropdown'.Selected.Name,
                              JobTitle: 'JobTitle.Input_1'.Text,
                              Phone: 'Phone.Input'.Text,
                              Role: 'Role.Dropdown'.Selected.Name,
                              Status: "Active"
                            }),
                            UpdateIf(colUsers, Id = varEditingUser.Id, {
                              FullName: 'FullName.Input'.Text,
                              Email: 'Email.Input'.Text,
                              Department: 'Department.Dropdown'.Selected.Name,
                              JobTitle: 'JobTitle.Input_1'.Text,
                              Phone: 'Phone.Input'.Text,
                              Role: 'Role.Dropdown'.Selected.Name
                            })
                          );
                          Set(varShowUserForm, false);
                          Notify(If(varFormMode = "Add", "Đã thêm người dùng thành công!", "Đã cập nhật thông tin người dùng!"), NotificationType.Success)
                        Size: =FontSizes.Medium
                        Text: =If(varFormMode = "Add", "Thêm người dùng", "Cập nhật")
                        Width: =Parent.Width * 0.2
                        X: =Parent.Width * 0.75
                        Y: =Parent.Height * 0.2
      - Delete.Modal.Overlay:
          Control: Rectangle
          Properties:
            Fill: =Styles.Modal.Overlay
            Height: =Parent.Height
            OnSelect: |
              =Set(varDeleteConfirm, false)
            Visible: =varDeleteConfirm
            Width: =Parent.Width
      - Delete.Confirmation.Modal:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            Fill: =Colors.White
            Height: =Parent.Height * 0.3
            Visible: =varDeleteConfirm
            Width: =Parent.Width * 0.4
            X: =If(varDeleteConfirm, (Parent.Width - Parent.Width * 0.4) / 2, -Parent.Width)
            Y: =If(varDeleteConfirm, (Parent.Height - Parent.Height * 0.3) / 2, -Parent.Height)
          Children:
            - Confirm.Header:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.Error
                  Height: =Parent.Height * 0.25
                  Width: =Parent.Width
                Children:
                  - Confirm.Title:
                      Control: Label
                      Properties:
                        Align: =Align.Center
                        Color: =Colors.White
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        Size: =FontSizes.Large
                        Text: ="Xác nhận xóa người dùng"
                        Width: =Parent.Width
            - Confirm.Content:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.5
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.25
                Children:
                  - Confirm.Message:
                      Control: Label
                      Properties:
                        Align: =Align.Center
                        Color: =Colors.TextPrimary
                        Height: =Parent.Height
                        Size: =FontSizes.Base
                        Text: =Concatenate("Bạn có chắc chắn muốn xóa người dùng ", varSelectedUser.FullName, "?")
                        Width: =Parent.Width * 0.9
                        X: =Parent.Width * 0.05
            - Confirm.Footer:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.25
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.75
                Children:
                  - Confirm.Cancel.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Styles.Button.Secondary.Color
                        Fill: =Styles.Button.Secondary.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Secondary.HoverFill
                        OnSelect: |
                          =Set(varDeleteConfirm, false)
                        Size: =FontSizes.Medium
                        Text: ="Hủy"
                        Width: =Parent.Width * 0.15
                        X: =Parent.Width * 0.3
                        Y: =Parent.Height * 0.2
                  - Confirm.Delete.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Error
                        Color: =Styles.Button.Danger.Color
                        Fill: =Styles.Button.Danger.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Danger.HoverFill
                        OnSelect: |
                          =RemoveIf(colUsers, Id = varSelectedUser.Id);
                          Set(varDeleteConfirm, false);
                          Notify("Đã xóa người dùng thành công!", NotificationType.Success)
                        Size: =FontSizes.Medium
                        Text: ="Xóa"
                        Width: =Parent.Width * 0.15
                        X: =Parent.Width * 0.55
                        Y: =Parent.Height * 0.2
      - User.Detail.Modal.Overlay:
          Control: Rectangle
          Properties:
            Fill: =Styles.Modal.Overlay
            Height: =Parent.Height
            OnSelect: |
              =Set(varShowUserDetail, false)
            Visible: =varShowUserDetail
            Width: =Parent.Width
      - User.Detail.Modal:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            BorderColor: =Colors.Border
            BorderThickness: =2
            Fill: =Colors.White
            Height: =Parent.Height * 0.7
            Visible: =varShowUserDetail
            Width: =Parent.Width * 0.5
            X: =If(varShowUserDetail, (Parent.Width - Parent.Width * 0.5) / 2, -Parent.Width * 2)
            Y: =If(varShowUserDetail, (Parent.Height - Parent.Height * 0.7) / 2, -Parent.Height * 2)
          Children:
            - Detail.Modal.Header:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.Primary
                  Height: =Parent.Height * 0.12
                  Width: =Parent.Width
                Children:
                  - Detail.Modal.Title:
                      Control: Label
                      Properties:
                        Color: =Colors.White
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        Size: =FontSizes.Large
                        Text: ="Thông tin người dùng"
                        Width: =Parent.Width * 0.6
                        X: =Parent.Width * 0.04
                  - Edit.Toggle.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.White
                        Color: =Colors.White
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =Parent.Height * 0.6
                        OnSelect: |
                          =If(varDetailFormMode = "View",
                            Set(varDetailFormMode, "Edit"),
                            Set(varDetailFormMode, "View")
                          )
                        Size: =FontSizes.Medium
                        Text: =If(varDetailFormMode = "View", "Chỉnh sửa ✎", "Huỷ chỉnh sửa ✕")
                        Width: =Parent.Width * 0.25
                        X: =Parent.Width * 0.6
                        Y: =Parent.Height * 0.2
                  - Detail.Modal.Close.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.White
                        Color: =Colors.White
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =Parent.Height * 0.6
                        OnSelect: |
                          =Set(varShowUserDetail, false);
                          Set(varDetailFormMode, "View")
                        Size: =FontSizes.Large
                        Text: ="×"
                        Width: =Parent.Height * 0.6
                        X: =Parent.Width * 0.9
                        Y: =Parent.Height * 0.2
            - Detail.Form.Content:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  Fill: =Colors.White
                  Height: =Parent.Height * 0.76
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.12
                Children:
                  - Detail.Form.Fields.Container:
                      Control: GroupContainer
                      Variant: ManualLayout
                      Properties:
                        Fill: =Colors.White
                        Height: =Parent.Height
                        Width: =Parent.Width
                      Children:
                        - Detail.FullName.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Họ và tên *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =20
                        - Detail.FullName.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.FullName
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =45
                        - Detail.FullName.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              Default: =varSelectedUser.FullName
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =45
                        - Detail.Email.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Email *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =20
                        - Detail.Email.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.Email
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =45
                        - Detail.Email.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              Default: =varSelectedUser.Email
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =45
                        - Detail.Department.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Phòng ban *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =95
                        - Detail.Department.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.Department
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =120
                        - Detail.Department.Dropdown:
                            Control: Classic/ComboBox
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              DefaultSelectedItems: |
                                =Filter(Table({Name: "Phòng Công nghệ thông tin"}, {Name: "Phòng Kế toán"}, {Name: "Phòng Nhân sự"}, {Name: "Phòng Marketing"}, {Name: "Ban Giám đốc"}), Name = varSelectedUser.Department)
                              Height: =Styles.Input.Height
                              Items: |
                                =Table({Name: "Phòng Công nghệ thông tin"}, {Name: "Phòng Kế toán"}, {Name: "Phòng Nhân sự"}, {Name: "Phòng Marketing"}, {Name: "Ban Giám đốc"})
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =120
                        - Detail.JobTitle.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Chức vụ *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =95
                        - Detail.JobTitle.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.JobTitle
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =120
                        - Detail.JobTitle.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              Default: =varSelectedUser.JobTitle
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =120
                        - Detail.Phone.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Số điện thoại *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =170
                        - Detail.Phone.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.Phone
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =195
                        - Detail.Phone.Input:
                            Control: Classic/TextInput
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              Default: =varSelectedUser.Phone
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.05
                              Y: =195
                        - Detail.Role.Label:
                            Control: Label
                            Properties:
                              Color: =Colors.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =25
                              Size: =FontSizes.Base
                              Text: ="Vai trò *"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =170
                        - Detail.Role.Display:
                            Control: Label
                            Properties:
                              BorderColor: =Colors.Border
                              BorderThickness: =If(varDetailFormMode = "View", 1, 0)
                              Color: =Colors.TextPrimary
                              Fill: =If(varDetailFormMode = "View", Colors.BackgroundLight, Colors.White)
                              Height: =Styles.Input.Height
                              Size: =FontSizes.Base
                              Text: =varSelectedUser.Role
                              Visible: =varDetailFormMode = "View"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =195
                        - Detail.Role.Dropdown:
                            Control: Classic/ComboBox
                            Properties:
                              BorderColor: =If(Self.Focused, Colors.Primary, Colors.Border)
                              DefaultSelectedItems: |
                                =Filter(Table({Name: "Employee"}, {Name: "Manager"}, {Name: "HR"}, {Name: "Admin"}), Name = varSelectedUser.Role)
                              Height: =Styles.Input.Height
                              Items: |
                                =Table({Name: "Employee"}, {Name: "Manager"}, {Name: "HR"}, {Name: "Admin"})
                              Size: =FontSizes.Base
                              Visible: =varDetailFormMode = "Edit"
                              Width: =Parent.Width * 0.4
                              X: =Parent.Width * 0.55
                              Y: =195
            - Detail.Form.Footer:
                Control: GroupContainer
                Variant: ManualLayout
                Properties:
                  BorderColor: =Colors.BorderLight
                  BorderThickness: =1
                  Fill: =Colors.BackgroundLight
                  Height: =Parent.Height * 0.12
                  Visible: =varDetailFormMode = "Edit"
                  Width: =Parent.Width
                  Y: =Parent.Height * 0.88
                Children:
                  - Detail.Cancel.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Border
                        Color: =Styles.Button.Secondary.Color
                        Fill: =Styles.Button.Secondary.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Secondary.HoverFill
                        OnSelect: |
                          =Set(varDetailFormMode, "View")
                        Size: =FontSizes.Medium
                        Text: ="Huỷ"
                        Width: =Parent.Width * 0.15
                        X: =Parent.Width * 0.55
                        Y: =Parent.Height * 0.2
                  - Detail.Save.Button:
                      Control: Classic/Button
                      Properties:
                        BorderColor: =Colors.Primary
                        Color: =Styles.Button.Primary.Color
                        Fill: =Styles.Button.Primary.Fill
                        Height: =Styles.Button.Height
                        HoverFill: =Styles.Button.Primary.HoverFill
                        OnSelect: |
                          =UpdateIf(colUsers, Id = varSelectedUser.Id, {
                            FullName: 'Detail.FullName.Input'.Text,
                            Email: 'Detail.Email.Input'.Text,
                            Department: 'Detail.Department.Dropdown'.Selected.Name,
                            JobTitle: 'Detail.JobTitle.Input'.Text,
                            Phone: 'Detail.Phone.Input'.Text,
                            Role: 'Detail.Role.Dropdown'.Selected.Name
                          });
                          Set(varSelectedUser, LookUp(colUsers, Id = varSelectedUser.Id));
                          Set(varDetailFormMode, "View");
                          Notify("Đã cập nhật thông tin người dùng thành công!", NotificationType.Success)
                        Size: =FontSizes.Medium
                        Text: ="Lưu"
                        Width: =Parent.Width * 0.2
                        X: =Parent.Width * 0.75
                        Y: =Parent.Height * 0.2
      - Loading.Overlay_1:
          Control: GroupContainer
          Variant: ManualLayout
          Properties:
            Fill: =RGBA(255, 255, 255, 0.8)
            Height: =Parent.Height
            Visible: =varLoadingUsers
            Width: =Parent.Width
          Children:
            - Loading.Spinner_1:
                Control: Classic/Icon
                Properties:
                  Color: =Colors.Primary
                  Height: =40
                  Icon: =Icon.Sync
                  Visible: =varLoadingUsers
                  Width: =40
                  X: =(Parent.Width - 40) / 2
                  Y: =(Parent.Height - 40) / 2
